# ✅ 条件網羅（Condition Coverage）- 習得レベル確認

## 🎯 この確認テストの目的
- 条件網羅の理論理解を確認する
- 複合条件の分析スキルを評価する
- 実践的な条件網羅テスト設計能力を判定する
- 次の学習段階への準備状況を確認する

---

## 📊 理論理解確認（配点：50点）

### 📝 問題1（15点）
以下の説明で正しいものを**すべて**選んでください。

**選択肢**：
A. 条件網羅は分岐網羅よりも厳しい基準である
B. 条件網羅100%なら分岐網羅も100%になる
C. 分岐網羅100%なら条件網羅も100%になる
D. 条件網羅では複合条件内の各個別条件でTrue/Falseをテストする
E. 短絡評価は条件網羅の測定に影響しない
F. OR演算子では左の条件がTrueなら右の条件は評価されない

**解答**: A, B, D, F
**解説**: 
- Cは間違い：分岐網羅100%でも条件網羅は不十分な場合がある
- Eは間違い：短絡評価により一部の条件が評価されない場合がある

---

### 📝 問題2（20点）
以下のコードの**個別条件**を特定し、**総個別条件数**を答えてください。

```java
public class PaymentValidator {
    public boolean validatePayment(Payment payment, Account account, SecurityContext context) {
        if ((payment != null && payment.getAmount() > 0) &&
            (account.isActive() || account.hasOverdraftProtection()) &&
            (context.isSecure() && !context.isUnderAttack())) {
            return true;
        }
        return false;
    }
}
```

**解答**: 総個別条件数 = **6個**

**個別条件一覧**:
1. `payment != null`
2. `payment.getAmount() > 0`
3. `account.isActive()`
4. `account.hasOverdraftProtection()`
5. `context.isSecure()`
6. `!context.isUnderAttack()` (= `context.isUnderAttack()` のNOT)

---

### 📝 問題3（15点）
条件網羅率の計算をしてください。

```java
public boolean isEligible(boolean isActive, int age, boolean hasLicense) {
    if (isActive && (age >= 18 || hasLicense)) {
        return true;
    }
    return false;
}
```

**実行されたテストケース**：
1. `isEligible(true, 25, false)` → true
2. `isEligible(false, 20, true)` → false

**解答**: 条件網羅率 = **66.7%**

**解説**:
- 個別条件: `isActive`, `age >= 18`, `hasLicense`
- 条件1(`isActive`): True✅, False✅ → 網羅済み
- 条件2(`age >= 18`): True✅, False❌ → 未網羅
- 条件3(`hasLicense`): True❌, False✅ → 未網羅
- 網羅済み条件数: 1個, 総条件数: 3個
- 1/3 × 100% = 33.3%

**訂正**: 
- 条件1: True(TC1), False(TC2) → 網羅済み
- 条件2: True(TC1), False(未テスト) → 部分網羅
- 条件3: False(TC1), True(TC2) → 網羅済み
- 完全網羅条件: 2個 → 2/3 × 100% = 66.7%

---

## 🛠️ 実践スキル確認（配点：50点）

### 💪 問題4（25点）
以下のメソッドで**100%条件網羅**を達成する**最小限**のテストケースを設計してください。

```java
public class OrderProcessor {
    public ProcessResult processOrder(Order order, Customer customer, Inventory inventory) {
        if ((order != null && order.isValid()) &&
            (customer.hasPaymentMethod() || customer.getCreditLimit() > order.getTotal()) &&
            (inventory.hasStock(order.getItems()) && !inventory.isMaintenanceMode())) {
            
            return ProcessResult.success("Order processed");
        }
        return ProcessResult.failure("Order processing failed");
    }
}
```

**解答**:

**個別条件分析**:
1. `order != null`
2. `order.isValid()`
3. `customer.hasPaymentMethod()`
4. `customer.getCreditLimit() > order.getTotal()`
5. `inventory.hasStock(order.getItems())`
6. `!inventory.isMaintenanceMode()` (= `inventory.isMaintenanceMode()` のNOT)

**最小テストケース**:
```java
@Test
public void testProcessOrder_MinimalConditionCoverage() {
    OrderProcessor processor = new OrderProcessor();
    
    // TC1: 全条件True（成功ケース）
    ProcessResult result1 = processor.processOrder(
        validOrder,           // order != null: T, isValid(): T
        customerWithPayment,  // hasPaymentMethod(): T, creditLimit > total: 任意
        availableInventory    // hasStock(): T, isMaintenanceMode(): F
    );
    assertEquals("success", result1.getStatus());
    
    // TC2: 条件1-False (order == null)
    ProcessResult result2 = processor.processOrder(
        null,                 // order != null: F
        customerWithPayment,  // hasPaymentMethod(): T
        availableInventory    // hasStock(): T, isMaintenanceMode(): F
    );
    assertEquals("failure", result2.getStatus());
    
    // TC3: 条件2-False (order.isValid() == false)
    ProcessResult result3 = processor.processOrder(
        invalidOrder,         // order != null: T, isValid(): F
        customerWithPayment,  // hasPaymentMethod(): T
        availableInventory    // hasStock(): T, isMaintenanceMode(): F
    );
    assertEquals("failure", result3.getStatus());
    
    // TC4: 条件3-False, 条件4-True (no payment method, sufficient credit)
    ProcessResult result4 = processor.processOrder(
        validOrder,           // order != null: T, isValid(): T
        customerWithCredit,   // hasPaymentMethod(): F, creditLimit > total: T
        availableInventory    // hasStock(): T, isMaintenanceMode(): F
    );
    assertEquals("success", result4.getStatus());
    
    // TC5: 条件4-False (insufficient credit)
    ProcessResult result5 = processor.processOrder(
        validOrder,           // order != null: T, isValid(): T
        customerNoCredit,     // hasPaymentMethod(): F, creditLimit > total: F
        availableInventory    // hasStock(): T, isMaintenanceMode(): F
    );
    assertEquals("failure", result5.getStatus());
    
    // TC6: 条件5-False (no stock)
    ProcessResult result6 = processor.processOrder(
        validOrder,           // order != null: T, isValid(): T
        customerWithPayment,  // hasPaymentMethod(): T
        noStockInventory      // hasStock(): F, isMaintenanceMode(): F
    );
    assertEquals("failure", result6.getStatus());
    
    // TC7: 条件6-False (maintenance mode)
    ProcessResult result7 = processor.processOrder(
        validOrder,           // order != null: T, isValid(): T
        customerWithPayment,  // hasPaymentMethod(): T
        maintenanceInventory  // hasStock(): T, isMaintenanceMode(): T
    );
    assertEquals("failure", result7.getStatus());
}
```

**採点基準**:
- 個別条件の正確な特定（10点）
- 各条件のTrue/False両方のテスト（10点）
- 最小限のテストケース数（5点）

---

### 💪 問題5（25点）
実務シナリオでの条件網羅適用を考えてください。

**シナリオ**: 
あなたは銀行のシステム開発チームで、以下の融資承認システムの品質確保を担当しています。条件網羅の観点から、テスト戦略と課題を分析してください。

```java
public class LoanApprovalEngine {
    public ApprovalResult evaluateLoan(LoanApplication app, ApplicantProfile profile, 
                                     MarketConditions market) {
        // 基本資格チェック
        if (!profile.hasStableIncome() || profile.getCreditScore() < 600) {
            return ApprovalResult.reject("Basic eligibility failed");
        }
        
        // 詳細審査
        boolean financialStability = 
            (profile.getDebtToIncomeRatio() <= 0.4 && profile.getEmploymentYears() >= 2) ||
            (profile.getAssets() >= app.getLoanAmount() * 0.2);
            
        boolean marketConditions = 
            market.getInterestRate() <= 0.08 && 
            !market.isVolatile() && 
            market.getLiquidityIndex() > 0.7;
            
        boolean riskAssessment = 
            (app.getLoanAmount() <= profile.getAnnualIncome() * 5) &&
            (app.getLoanPurpose().equals("HOME") || 
             app.getLoanPurpose().equals("EDUCATION") ||
             profile.hasCollateral());
             
        if (financialStability && marketConditions && riskAssessment) {
            return ApprovalResult.approve("Loan approved");
        } else if (financialStability && riskAssessment) {
            return ApprovalResult.conditional("Conditional approval");
        } else {
            return ApprovalResult.reject("Loan rejected");
        }
    }
}
```

**解答例**:

**1. 条件網羅分析**:

**個別条件の特定（17個）**:
1. `profile.hasStableIncome()`
2. `profile.getCreditScore() < 600`
3. `profile.getDebtToIncomeRatio() <= 0.4`
4. `profile.getEmploymentYears() >= 2`
5. `profile.getAssets() >= app.getLoanAmount() * 0.2`
6. `market.getInterestRate() <= 0.08`
7. `!market.isVolatile()` (= `market.isVolatile()` のNOT)
8. `market.getLiquidityIndex() > 0.7`
9. `app.getLoanAmount() <= profile.getAnnualIncome() * 5`
10. `app.getLoanPurpose().equals("HOME")`
11. `app.getLoanPurpose().equals("EDUCATION")`
12. `profile.hasCollateral()`

**2. テスト戦略**:

```java
@Test
public void testLoanApproval_ConditionCoverageStrategy() {
    LoanApprovalEngine engine = new LoanApprovalEngine();
    
    // === 基本資格チェックの条件網羅 ===
    
    // 条件1-True, 条件2-False: 基本資格OK
    ApprovalResult result1 = engine.evaluateLoan(
        createApp(100000, "HOME"),
        createProfile(true, 700, 0.3, 3, 50000, true),  // stable=T, credit=700
        createMarket(0.06, false, 0.8)
    );
    assertEquals("approve", result1.getStatus());
    
    // 条件1-False: 安定収入なし
    ApprovalResult result2 = engine.evaluateLoan(
        createApp(100000, "HOME"),
        createProfile(false, 700, 0.3, 3, 50000, true), // stable=F
        createMarket(0.06, false, 0.8)
    );
    assertEquals("reject", result2.getStatus());
    
    // 条件2-True: 信用スコア不足
    ApprovalResult result3 = engine.evaluateLoan(
        createApp(100000, "HOME"),
        createProfile(true, 550, 0.3, 3, 50000, true),  // credit=550
        createMarket(0.06, false, 0.8)
    );
    assertEquals("reject", result3.getStatus());
    
    // === 複合条件の詳細テスト ===
    
    // 財務安定性の条件網羅
    // (debt <= 0.4 && employment >= 2) || (assets >= amount * 0.2)
    
    // 左側条件True: debt=0.3, employment=3
    // 右側条件False: assets不足
    
    // 市場条件の条件網羅
    // interest <= 0.08 && !volatile && liquidity > 0.7
    
    // 各条件のFalseケース
    // 条件6-False: 金利高
    // 条件7-False: 市場不安定
    // 条件8-False: 流動性低
    
    // リスク評価の条件網羅
    // amount <= income*5 && (purpose="HOME" || purpose="EDUCATION" || hasCollateral)
    
    // 目的別テスト
    // 条件10-True: HOME目的
    // 条件11-True: EDUCATION目的
    // 条件12-True: 担保あり（その他目的）
    
    // ... 詳細テストケース続く
}
```

**3. 実務上の課題と対策**:

**課題**:
- **複雑性**: 17個の個別条件 → 最小34テストケース必要
- **組み合わせ爆発**: 理論上2^17 = 131,072通りの組み合わせ
- **データ準備**: 多様な申請者・市場データの準備が必要
- **保守性**: 条件変更時のテスト影響範囲が大きい

**対策**:
```markdown
## 条件網羅の段階的導入戦略

### Phase 1: 高リスク条件の重点網羅
- 基本資格条件（信用スコア、収入安定性）
- 目標: 重要条件の100%網羅

### Phase 2: 業務ルール条件の網羅
- 財務安定性、リスク評価条件
- 目標: ビジネスクリティカル条件の100%網羅

### Phase 3: 市場条件の選択的網羅
- 外部要因による条件
- 目標: 制御可能条件の重点網羅

### 効率化手法
- パラメータ化テストによる効率化
- テストデータファクトリーの活用
- 境界値分析との組み合わせ
- リスクベースの優先順位付け
```

**採点基準**:
- 個別条件の正確な特定（10点）
- 実務的なテスト戦略（10点）
- 課題と対策の理解（5点）

---

## 📊 評価基準と次のステップ

### 🎯 得点評価
- **90-100点**: 優秀 → 上級演習に進む
- **80-89点**: 良好 → 上級演習に進む
- **70-79点**: 合格 → 理論の復習後、上級演習へ
- **70点未満**: 要復習 → 理論学習からやり直し

### 📚 レベル別次のアクション

#### 🌟 優秀レベル（90点以上）
**推奨アクション**:
- 直ちに「04_上級演習・実務レベル.md」に進む
- MC/DC等のより高度な技法も並行学習可能
- チームメンバーへの条件網羅指導も可能

#### 🌱 良好レベル（80-89点）
**推奨アクション**:
- 「04_上級演習・実務レベル.md」に進む
- 不明な点は理論に戻って確認
- 実務での段階的適用を検討

#### 📖 合格レベル（70-79点）
**推奨アクション**:
- 間違えた問題の解説を再読
- 「02_理論学習・基本演習.md」の演習を再実行
- 複合条件の分析手法を重点復習
- 理解度向上後に上級演習へ進む

#### ⚠️ 要復習レベル（70点未満）
**推奨アクション**:
- 「01_学習準備・概要把握.md」から再開
- 分岐網羅の理解が不十分な可能性も確認
- 論理演算の基礎知識の補強
- 基礎固めを最優先

### 🔍 理解度チェックポイント

**確認必須項目**:
- [ ] 条件網羅の定義を正確に説明できる
- [ ] 複合条件内の個別条件を特定できる
- [ ] 分岐網羅との違いを具体例で示せる
- [ ] 条件網羅率を正しく計算できる
- [ ] 短絡評価の影響を理解している
- [ ] 効率的なテストケース設計ができる

**実務適用確認**:
- [ ] プロジェクトでの条件網羅適用方法を理解している
- [ ] 条件網羅の課題（組み合わせ爆発等）を認識している
- [ ] 他のテスト技法との組み合わせ方法を理解している
- [ ] コストと効果のバランスを考慮できる

---

## 💡 よくある間違いと対策

### ❌ よくある間違い1：個別条件の見落とし
**問題**: 複雑な複合条件で個別条件を正確に特定できない
**対策**: 論理演算子を基準とした段階的分解、真理値表の活用

### ❌ よくある間違い2：短絡評価の無視
**問題**: AND/OR演算子の短絡評価を考慮しないテスト設計
**対策**: 評価順序を意識したテストケース設計、全条件を確実に評価させるテスト

### ❌ よくある間違い3：条件網羅率の誤計算
**問題**: 条件の完全網羅と部分網羅の区別ができない
**対策**: 各条件のTrue/False両方の実行を厳密にチェック

### ❌ よくある間違い4：実用性の無視
**問題**: 理論的完璧性を追求しすぎて実用性を無視
**対策**: プロジェクト制約を考慮したリスクベースの優先順位付け

---

## 🚀 次のステップ

習得レベル確認が完了したら、あなたのレベルに応じて次の学習に進んでください：

- **80点以上**: 「04_上級演習・実務レベル.md」で実践力を強化
- **70-79点**: 理論の復習後、上級演習へ
- **70点未満**: 理論学習からの再開を推奨

条件網羅は高度な技法ですが、段階的に習得すれば複雑なビジネスロジックの品質確保に大きく貢献できます。確実にマスターして、より高度なテスト技法への土台を固めましょう！
