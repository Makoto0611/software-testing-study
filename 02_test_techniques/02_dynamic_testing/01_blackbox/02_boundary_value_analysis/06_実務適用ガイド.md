# 🚀 境界値分析 実務適用ガイド

## 📚 この段階の目的

**実務で境界値分析を効果的に使えるようになる**
- [ ] 同値分割と組み合わせて使える
- [ ] チームで共有・活用できる
- [ ] プロジェクトで実践できる

**⏰ 推奨時間**: 約45分

---

## 🎯 同値分割との組み合わせ【最重要】

### 💡 基本の流れ

```
1. 同値分割で範囲を分ける
   ↓
2. 境界値分析で境目を特定
   ↓
3. 代表値 + 境界値でテストケース作成
```

### 📝 実践演習

#### **課題: 会員ランク判定**
```
ポイント数による会員ランク
- Bronze: 0-999ポイント
- Silver: 1000-4999ポイント  
- Gold: 5000-9999ポイント
- Platinum: 10000ポイント以上
```

**Q1. 同値分割してください**
```
同値クラス1: [        ] (期待結果: Bronze)
同値クラス2: [        ] (期待結果: Silver)
同値クラス3: [        ] (期待結果: Gold)
同値クラス4: [        ] (期待結果: Platinum)
```

**Q2. 各境界の境界値を特定してください**
```
Bronze-Silver境界: [            ]
Silver-Gold境界: [            ]
Gold-Platinum境界: [            ]
```

**Q3. 代表値を選んでください**
```
Bronze代表値: [    ]
Silver代表値: [    ]
Gold代表値: [    ]
Platinum代表値: [    ]
```

**Q4. 完全なテストケース表を作成してください**

| ID | ポイント | 期待ランク | テスト種別 |
|----|---------|-----------|-----------|
| TC001 | | Bronze | 代表値 |
| TC002 | | Silver | 代表値 |
| TC003 | | Gold | 代表値 |
| TC004 | | Platinum | 代表値 |
| TC005 | | Bronze | 境界値 |
| TC006 | | Silver | 境界値 |
| TC007 | | Silver | 境界値 |
| TC008 | | Gold | 境界値 |
| TC009 | | Gold | 境界値 |
| TC010 | | Platinum | 境界値 |

<details>
<summary>💡 解答</summary>

**Q1. 同値分割**
```
同値クラス1: 0-999 (Bronze)
同値クラス2: 1000-4999 (Silver)
同値クラス3: 5000-9999 (Gold)
同値クラス4: 10000以上 (Platinum)
```

**Q2. 境界値**
```
Bronze-Silver境界: 999, 1000, 1001
Silver-Gold境界: 4999, 5000, 5001
Gold-Platinum境界: 9999, 10000, 10001
```

**Q3. 代表値**
```
Bronze代表値: 500
Silver代表値: 3000
Gold代表値: 7500
Platinum代表値: 15000
```

**Q4. 完全なテストケース表**

| ID | ポイント | 期待ランク | テスト種別 |
|----|---------|-----------|-----------|
| TC001 | 500 | Bronze | 代表値 |
| TC002 | 3000 | Silver | 代表値 |
| TC003 | 7500 | Gold | 代表値 |
| TC004 | 15000 | Platinum | 代表値 |
| TC005 | 999 | Bronze | 境界値（上限） |
| TC006 | 1000 | Silver | 境界値（下限） |
| TC007 | 1001 | Silver | 境界値（下限+1） |
| TC008 | 4999 | Silver | 境界値（上限） |
| TC009 | 5000 | Gold | 境界値（下限） |
| TC010 | 5001 | Gold | 境界値（下限+1） |
| TC011 | 9999 | Gold | 境界値（上限） |
| TC012 | 10000 | Platinum | 境界値（下限） |
| TC013 | 10001 | Platinum | 境界値（下限+1） |

**PHPUnit実装**
```php
class MemberRankCalculatorTest extends TestCase
{
    private MemberRankCalculator $calculator;

    protected function setUp(): void
    {
        $this->calculator = new MemberRankCalculator();
    }

    /** @test 代表値テスト */
    public function ポイント500_Bronze()
    {
        $this->assertEquals('Bronze', $this->calculator->getRank(500));
    }

    /** @test */
    public function ポイント3000_Silver()
    {
        $this->assertEquals('Silver', $this->calculator->getRank(3000));
    }

    /** @test */
    public function ポイント7500_Gold()
    {
        $this->assertEquals('Gold', $this->calculator->getRank(7500));
    }

    /** @test */
    public function ポイント15000_Platinum()
    {
        $this->assertEquals('Platinum', $this->calculator->getRank(15000));
    }

    /** @test 境界値テスト */
    public function ポイント999_Bronze()
    {
        $this->assertEquals('Bronze', $this->calculator->getRank(999));
    }

    /** @test */
    public function ポイント1000_Silver()
    {
        $this->assertEquals('Silver', $this->calculator->getRank(1000));
    }

    // 残りの境界値テストも同様に実装...
}
```
</details>

---

## 🎯 実務シナリオ演習

### 📝 演習1: ECサイト送料計算【難易度: ★★☆】

#### 仕様
```
送料計算ルール
- 購入金額3,000円未満: 送料500円
- 購入金額3,000円以上: 送料無料
- 離島配送: +300円（購入金額問わず）
- 冷凍商品: +200円
```

#### 課題
**Q1. 同値分割 + 境界値分析を実行してください**

**Q2. PHPUnitで実装してください**

```php
class ShippingCalculator
{
    // [実装]
}

class ShippingCalculatorTest extends TestCase
{
    // [テスト実装]
}
```

<details>
<summary>💡 解答例</summary>

```php
class ShippingCalculator
{
    private const FREE_SHIPPING_THRESHOLD = 3000;
    private const BASE_SHIPPING = 500;
    private const REMOTE_AREA_FEE = 300;
    private const FROZEN_FEE = 200;

    public function calculate(
        int $amount,
        bool $isRemoteArea = false,
        bool $hasFrozen = false
    ): int {
        $shipping = 0;

        // 基本送料
        if ($amount < self::FREE_SHIPPING_THRESHOLD) {
            $shipping = self::BASE_SHIPPING;
        }

        // 離島配送
        if ($isRemoteArea) {
            $shipping += self::REMOTE_AREA_FEE;
        }

        // 冷凍商品
        if ($hasFrozen) {
            $shipping += self::FROZEN_FEE;
        }

        return $shipping;
    }
}

class ShippingCalculatorTest extends TestCase
{
    private ShippingCalculator $calculator;

    protected function setUp(): void
    {
        $this->calculator = new ShippingCalculator();
    }

    /** @test 代表値 - 通常配送 */
    public function 購入金額1500円_送料500円()
    {
        $this->assertEquals(500, $this->calculator->calculate(1500));
    }

    /** @test */
    public function 購入金額5000円_送料無料()
    {
        $this->assertEquals(0, $this->calculator->calculate(5000));
    }

    /** @test 境界値 - 送料無料ライン */
    public function 購入金額2999円_送料500円()
    {
        $this->assertEquals(500, $this->calculator->calculate(2999));
    }

    /** @test */
    public function 購入金額3000円_送料無料()
    {
        $this->assertEquals(0, $this->calculator->calculate(3000));
    }

    /** @test */
    public function 購入金額3001円_送料無料()
    {
        $this->assertEquals(0, $this->calculator->calculate(3001));
    }

    /** @test 離島配送 */
    public function 購入金額2999円_離島_送料800円()
    {
        $this->assertEquals(800, $this->calculator->calculate(2999, true));
    }

    /** @test */
    public function 購入金額3000円_離島_送料300円()
    {
        $this->assertEquals(300, $this->calculator->calculate(3000, true));
    }

    /** @test 冷凍商品 */
    public function 購入金額2999円_冷凍_送料700円()
    {
        $this->assertEquals(700, $this->calculator->calculate(2999, false, true));
    }

    /** @test */
    public function 購入金額3000円_冷凍_送料200円()
    {
        $this->assertEquals(200, $this->calculator->calculate(3000, false, true));
    }

    /** @test 複合条件 */
    public function 購入金額2999円_離島_冷凍_送料1000円()
    {
        $this->assertEquals(1000, $this->calculator->calculate(2999, true, true));
    }

    /** @test */
    public function 購入金額3000円_離島_冷凍_送料500円()
    {
        $this->assertEquals(500, $this->calculator->calculate(3000, true, true));
    }
}
```
</details>

---

### 📝 演習2: クーポン適用【難易度: ★★★】

#### 仕様
```
クーポン適用ルール
- 割引率: 10%, 20%, 30%の3種類
- 最大割引額: 5,000円
- 最低購入金額: 3,000円以上で適用可
- 有効期限: 期限内のみ適用可
```

#### 課題
**完全な実装を書いてください**

<details>
<summary>💡 解答例</summary>

```php
class CouponApplier
{
    private const MIN_PURCHASE = 3000;
    private const MAX_DISCOUNT = 5000;

    public function apply(
        int $amount,
        int $discountRate,
        \DateTime $today,
        \DateTime $expiryDate
    ): array {
        // 有効期限チェック
        if ($today > $expiryDate) {
            return ['discount' => 0, 'reason' => 'クーポンの有効期限が切れています'];
        }

        // 最低購入金額チェック
        if ($amount < self::MIN_PURCHASE) {
            return ['discount' => 0, 'reason' => '最低購入金額に達していません'];
        }

        // 割引計算
        $discount = (int) ($amount * ($discountRate / 100));
        
        // 最大割引額制限
        if ($discount > self::MAX_DISCOUNT) {
            $discount = self::MAX_DISCOUNT;
        }

        return ['discount' => $discount, 'reason' => ''];
    }
}

class CouponApplierTest extends TestCase
{
    private CouponApplier $applier;
    private \DateTime $today;
    private \DateTime $validExpiry;
    private \DateTime $expiredDate;

    protected function setUp(): void
    {
        $this->applier = new CouponApplier();
        $this->today = new \DateTime('2025-01-15');
        $this->validExpiry = new \DateTime('2025-01-31');
        $this->expiredDate = new \DateTime('2025-01-14');
    }

    /** @test 最低購入金額境界値 */
    public function 購入金額2999円_割引なし()
    {
        $result = $this->applier->apply(2999, 10, $this->today, $this->validExpiry);
        $this->assertEquals(0, $result['discount']);
    }

    /** @test */
    public function 購入金額3000円_割引あり()
    {
        $result = $this->applier->apply(3000, 10, $this->today, $this->validExpiry);
        $this->assertEquals(300, $result['discount']);
    }

    /** @test 最大割引額境界値 - 10%クーポン */
    public function 購入金額49999円_10%割引_4999円()
    {
        $result = $this->applier->apply(49999, 10, $this->today, $this->validExpiry);
        $this->assertEquals(4999, $result['discount']);
    }

    /** @test */
    public function 購入金額50000円_10%割引_上限5000円()
    {
        $result = $this->applier->apply(50000, 10, $this->today, $this->validExpiry);
        $this->assertEquals(5000, $result['discount']);
    }

    /** @test */
    public function 購入金額50001円_10%割引_上限5000円()
    {
        $result = $this->applier->apply(50001, 10, $this->today, $this->validExpiry);
        $this->assertEquals(5000, $result['discount']);
    }

    /** @test 最大割引額境界値 - 20%クーポン */
    public function 購入金額24999円_20%割引_4999円()
    {
        $result = $this->applier->apply(24999, 20, $this->today, $this->validExpiry);
        $this->assertEquals(4999, $result['discount']);
    }

    /** @test */
    public function 購入金額25000円_20%割引_上限5000円()
    {
        $result = $this->applier->apply(25000, 20, $this->today, $this->validExpiry);
        $this->assertEquals(5000, $result['discount']);
    }

    /** @test 最大割引額境界値 - 30%クーポン */
    public function 購入金額16666円_30%割引_4999円()
    {
        $result = $this->applier->apply(16666, 30, $this->today, $this->validExpiry);
        $this->assertEquals(4999, $result['discount']);
    }

    /** @test */
    public function 購入金額16667円_30%割引_上限5000円()
    {
        $result = $this->applier->apply(16667, 30, $this->today, $this->validExpiry);
        $this->assertEquals(5000, $result['discount']);
    }

    /** @test 有効期限境界値 */
    public function 有効期限前日_割引あり()
    {
        $yesterday = new \DateTime('2025-01-14');
        $result = $this->applier->apply(5000, 10, $yesterday, $this->validExpiry);
        $this->assertEquals(500, $result['discount']);
    }

    /** @test */
    public function 有効期限当日_割引あり()
    {
        $result = $this->applier->apply(5000, 10, $this->validExpiry, $this->validExpiry);
        $this->assertEquals(500, $result['discount']);
    }

    /** @test */
    public function 有効期限翌日_割引なし()
    {
        $tomorrow = new \DateTime('2025-02-01');
        $result = $this->applier->apply(5000, 10, $tomorrow, $this->validExpiry);
        $this->assertEquals(0, $result['discount']);
    }
}
```
</details>

---

## 🎯 チームでの活用方法

### 📋 レビューチェックリスト

#### **境界値分析レビューポイント**

```markdown
## テストケースレビューシート

### 境界値分析の確認
- [ ] すべての範囲制約に対して境界値が特定されている
- [ ] 境界値の±1パターンが網羅されている
- [ ] 同値分割の代表値も含まれている
- [ ] 複数条件の組み合わせ境界値が考慮されている

### テストケースの品質
- [ ] 期待結果が明確に記載されている
- [ ] 境界値の理由・根拠が明確
- [ ] 実装可能な具体的なテスト値
- [ ] 優先度が適切に設定されている

### 実装の確認
- [ ] PHPUnitテストが実装されている
- [ ] テストが実際に実行できる
- [ ] エッジケースが考慮されている
- [ ] データプロバイダが適切に活用されている
```

### 💬 チーム共有フォーマット

#### **境界値分析ナレッジシート**

```markdown
## 機能: [機能名]

### 仕様概要
[仕様の簡潔な説明]

### 同値分割
| 同値クラス | 範囲 | 期待結果 | 代表値 |
|-----------|------|----------|--------|
| | | | |

### 境界値
| 境界 | 境界値 | 期待結果 | 重要度 |
|------|--------|----------|--------|
| | | | |

### テストケース数
- 代表値: X件
- 境界値: Y件
- 合計: Z件

### 実装状況
- [ ] PHPUnitテスト実装
- [ ] レビュー完了
- [ ] テスト実行確認

### 備考・注意点
[特記事項]
```

---

## 🎯 プロジェクトでの実践

### 📝 演習3: 実プロジェクトシミュレーション【難易度: ★★★】

#### シナリオ
```
あなたは新規ECサイトプロジェクトのQAリードです。
以下の機能のテスト戦略を立ててください。

機能: ポイント利用システム
仕様:
- 保有ポイント: 0-999,999ポイント
- 利用単位: 100ポイント単位
- 利用率制限: 購入金額の30%まで
- 最低利用: 100ポイント
- 端数処理: 切り捨て
```

#### 課題

**Q1. テスト戦略を立ててください**
```
重点テスト領域:
1. [                    ]
2. [                    ]
3. [                    ]

リスクの高い境界値:
1. [                    ]
2. [                    ]
3. [                    ]
```

**Q2. 工数見積もり**
```
テスト設計: [  ]時間
テスト実装: [  ]時間
テスト実行: [  ]時間
合計: [  ]時間
```

**Q3. 完全な実装**

<details>
<summary>💡 解答例</summary>

**Q1. テスト戦略**
```
重点テスト領域:
1. 100ポイント単位の境界値
2. 30%制限の境界値
3. 保有ポイント上限の境界値

リスクの高い境界値:
1. 100ポイント単位（99, 100, 101）
2. 30%制限付近の計算
3. 999,999ポイント上限
```

**Q2. 工数見積もり**
```
テスト設計: 2時間
テスト実装: 3時間
テスト実行: 1時間
合計: 6時間
```

**Q3. 完全な実装**
```php
class PointUsageService
{
    private const MIN_USAGE = 100;
    private const USAGE_UNIT = 100;
    private const MAX_USAGE_RATE = 0.30;
    private const MAX_POINTS = 999999;

    public function calculateUsablePoints(
        int $ownedPoints,
        int $purchaseAmount
    ): array {
        if ($ownedPoints < self::MIN_USAGE) {
            return [
                'usable' => 0,
                'reason' => '最低利用ポイントは100ポイントです'
            ];
        }

        // 30%制限
        $maxByRate = (int) ($purchaseAmount * self::MAX_USAGE_RATE);
        $maxByRate = (int) (floor($maxByRate / self::USAGE_UNIT) * self::USAGE_UNIT);

        // 保有ポイント制限
        $maxByOwned = (int) (floor($ownedPoints / self::USAGE_UNIT) * self::USAGE_UNIT);

        $usable = min($maxByRate, $maxByOwned);

        return [
            'usable' => $usable,
            'reason' => ''
        ];
    }
}

class PointUsageServiceTest extends TestCase
{
    private PointUsageService $service;

    protected function setUp(): void
    {
        $this->service = new PointUsageService();
    }

    /** @test 最低利用ポイント境界値 */
    public function 保有99ポイント_利用不可()
    {
        $result = $this->service->calculateUsablePoints(99, 10000);
        $this->assertEquals(0, $result['usable']);
    }

    /** @test */
    public function 保有100ポイント_利用可能()
    {
        $result = $this->service->calculateUsablePoints(100, 10000);
        $this->assertEquals(100, $result['usable']);
    }

    /** @test 100ポイント単位境界値 */
    public function 保有199ポイント_100ポイント利用()
    {
        $result = $this->service->calculateUsablePoints(199, 10000);
        $this->assertEquals(100, $result['usable']);
    }

    /** @test */
    public function 保有200ポイント_200ポイント利用()
    {
        $result = $this->service->calculateUsablePoints(200, 10000);
        $this->assertEquals(200, $result['usable']);
    }

    /** @test 30%制限境界値 */
    public function 購入10000円_保有5000ポイント_上限3000ポイント()
    {
        // 10000 * 0.3 = 3000
        $result = $this->service->calculateUsablePoints(5000, 10000);
        $this->assertEquals(3000, $result['usable']);
    }

    /** @test */
    public function 購入9999円_保有5000ポイント_上限2900ポイント()
    {
        // 9999 * 0.3 = 2999.7 → 2900 (100単位切り捨て)
        $result = $this->service->calculateUsablePoints(5000, 9999);
        $this->assertEquals(2900, $result['usable']);
    }

    /** @test 保有ポイント上限境界値 */
    public function 保有999899ポイント_購入金額十分_999800ポイント利用()
    {
        $result = $this->service->calculateUsablePoints(999899, 10000000);
        $this->assertEquals(999800, $result['usable']);
    }

    /** @test */
    public function 保有999999ポイント_購入金額十分_999900ポイント利用()
    {
        $result = $this->service->calculateUsablePoints(999999, 10000000);
        $this->assertEquals(999900, $result['usable']);
    }

    /** @test 複合境界値 */
    public function 購入333円_保有1000ポイント_上限0ポイント()
    {
        // 333 * 0.3 = 99.9 → 0 (100未満切り捨て)
        $result = $this->service->calculateUsablePoints(1000, 333);
        $this->assertEquals(0, $result['usable']);
    }

    /** @test */
    public function 購入334円_保有1000ポイント_上限100ポイント()
    {
        // 334 * 0.3 = 100.2 → 100
        $result = $this->service->calculateUsablePoints(1000, 334);
        $this->assertEquals(100, $result['usable']);
    }
}
```
</details>

---

## 📊 学習成果の確認

### ✅ **実務適用チェックリスト**

- [ ] 同値分割と境界値分析を組み合わせて使える
- [ ] チームで共有できるフォーマットを理解した
- [ ] レビューポイントを把握した
- [ ] 実プロジェクトで適用できるイメージができた

### 📝 **振り返り**

**身についたスキル**
```
例:
- 同値分割との組み合わせ方
- 実務シナリオでの適用方法
- チームでの共有・レビュー方法
```

**実務で活かすこと**
```
例:
- 次のスプリントでの適用
- チームレビューでの観点追加
- テスト自動化への組み込み
```

---

## 🚀 まとめ

### 🎯 **学習完了**

境界値分析の全学習が完了しました！

**習得内容**
- ✅ 基本理論と手順
- ✅ 同値分割との組み合わせ
- ✅ 実務レベルの演習
- ✅ チームでの活用方法
- ✅ プロジェクト適用戦略

### 💪 **次のアクション**

**実務で実践**
- 現在のプロジェクトで試してみる
- チームメンバーと共有する
- 継続的に改善する

**スキルアップ**
- デシジョンテーブルと組み合わせる
- 状態遷移テストを学ぶ
- テスト自動化を進める

**🎉 境界値分析マスター達成！実務での活躍を期待しています！**