# ğŸš€ åˆ†å²ç¶²ç¾…ï¼ˆBranch Coverageï¼‰- ä¸Šç´šæ¼”ç¿’ãƒ»å®Ÿå‹™ãƒ¬ãƒ™ãƒ«

## ğŸ¯ ä¸Šç´šæ¼”ç¿’ã®ç›®çš„
- è¤‡é›‘ãªå®Ÿå‹™ã‚³ãƒ¼ãƒ‰ã§ã®åˆ†å²ç¶²ç¾…é©ç”¨
- ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã‚’è€ƒæ…®ã—ãŸåŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆè¨­è¨ˆ
- å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚·ãƒŠãƒªã‚ªã§ã®å•é¡Œè§£æ±º

---

## ğŸ’ª ä¸Šç´šæ¼”ç¿’ 1ï¼šè¤‡é›‘ãªæ¥­å‹™ãƒ­ã‚¸ãƒƒã‚¯

### ğŸ“ å•é¡Œï¼šä¿é™ºæ–™è¨ˆç®—ã‚·ã‚¹ãƒ†ãƒ 
ä»¥ä¸‹ã®ä¿é™ºæ–™è¨ˆç®—ãƒ¡ã‚½ãƒƒãƒ‰ã§**100%åˆ†å²ç¶²ç¾…**ã‚’é”æˆã—ã€ã‹ã¤**å®Ÿå‹™ã§æœ‰åŠ¹**ãªãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¨­è¨ˆã—ã¦ãã ã•ã„ã€‚

```java
public class InsurancePremiumCalculator {
    
    public PremiumResult calculatePremium(Customer customer, Policy policy) {
        // å…¥åŠ›æ¤œè¨¼
        if (customer == null || policy == null) {
            return new PremiumResult(0, "Invalid input", false);
        }
        
        if (customer.getAge() < 18 || customer.getAge() > 100) {
            return new PremiumResult(0, "Age out of range", false);
        }
        
        // åŸºæœ¬ä¿é™ºæ–™è¨ˆç®—
        double basePremium = policy.getBasePremium();
        double finalPremium = basePremium;
        
        // å¹´é½¢ã«ã‚ˆã‚‹ä¿‚æ•°
        if (customer.getAge() >= 65) {
            finalPremium *= 1.5;  // é«˜é½¢è€…å‰²å¢—
        } else if (customer.getAge() >= 40) {
            finalPremium *= 1.2;  // ä¸­å¹´å‰²å¢—
        } else if (customer.getAge() >= 25) {
            finalPremium *= 1.0;  // æ¨™æº–
        } else {
            finalPremium *= 0.8;  // è‹¥å¹´è€…å‰²å¼•
        }
        
        // ãƒªã‚¹ã‚¯è¦å› ãƒã‚§ãƒƒã‚¯
        boolean hasRiskFactors = false;
        if (customer.isSmoker()) {
            finalPremium *= 1.3;
            hasRiskFactors = true;
        }
        
        if (customer.hasChronicDisease()) {
            finalPremium *= 1.4;
            hasRiskFactors = true;
        }
        
        // è·æ¥­ãƒªã‚¹ã‚¯
        if (customer.getOccupation() != null) {
            String occupation = customer.getOccupation().toLowerCase();
            if (occupation.contains("pilot") || occupation.contains("mining")) {
                finalPremium *= 2.0;
                hasRiskFactors = true;
            } else if (occupation.contains("construction") || occupation.contains("firefighter")) {
                finalPremium *= 1.6;
                hasRiskFactors = true;
            }
        }
        
        // ä¿é™ºæœŸé–“ã«ã‚ˆã‚‹èª¿æ•´
        int years = policy.getTermYears();
        if (years >= 30) {
            finalPremium *= 0.9;  // é•·æœŸå‰²å¼•
        } else if (years >= 20) {
            finalPremium *= 0.95; // ä¸­æœŸå‰²å¼•
        }
        // çŸ­æœŸï¼ˆ20å¹´æœªæº€ï¼‰ã¯å‰²å¼•ãªã—
        
        // å®¶æ—å‰²å¼•
        if (customer.getFamilySize() >= 4) {
            finalPremium *= 0.9;
        } else if (customer.getFamilySize() >= 2) {
            finalPremium *= 0.95;
        }
        
        // å¥åº·ãƒœãƒ¼ãƒŠã‚¹ï¼ˆãƒªã‚¹ã‚¯è¦å› ãŒãªã„å ´åˆï¼‰
        if (!hasRiskFactors && customer.hasHealthCertificate()) {
            finalPremium *= 0.85;
        }
        
        // æœ€ä½ä¿é™ºæ–™ãƒã‚§ãƒƒã‚¯
        double minimumPremium = 1000.0;
        if (finalPremium < minimumPremium) {
            finalPremium = minimumPremium;
        }
        
        return new PremiumResult(finalPremium, "Calculation completed", true);
    }
}
```

### ğŸ¤” åˆ†æã‚¹ãƒ†ãƒƒãƒ—

#### ã‚¹ãƒ†ãƒƒãƒ—1: åˆ†å²ã®ç³»çµ±çš„ç‰¹å®š
```java
// å…¥åŠ›æ¤œè¨¼åˆ†å²
if (customer == null || policy == null)           // åˆ†å²1: T/F
if (customer.getAge() < 18 || customer.getAge() > 100)  // åˆ†å²2: T/F

// å¹´é½¢åˆ†å²ï¼ˆæ’ä»–çš„ï¼‰
if (customer.getAge() >= 65)                      // åˆ†å²3: T/F
else if (customer.getAge() >= 40)                 // åˆ†å²4: T/F
else if (customer.getAge() >= 25)                 // åˆ†å²5: T/F
else                                              // åˆ†å²6: è‡ªå‹•å®Ÿè¡Œ

// ãƒªã‚¹ã‚¯è¦å› åˆ†å²
if (customer.isSmoker())                          // åˆ†å²7: T/F
if (customer.hasChronicDisease())                 // åˆ†å²8: T/F

// è·æ¥­åˆ†å²
if (customer.getOccupation() != null)             // åˆ†å²9: T/F
  if (occupation.contains("pilot") || occupation.contains("mining"))  // åˆ†å²10: T/F
  else if (occupation.contains("construction") || occupation.contains("firefighter"))  // åˆ†å²11: T/F

// æœŸé–“åˆ†å²
if (years >= 30)                                  // åˆ†å²12: T/F
else if (years >= 20)                             // åˆ†å²13: T/F

// å®¶æ—åˆ†å²
if (customer.getFamilySize() >= 4)                // åˆ†å²14: T/F
else if (customer.getFamilySize() >= 2)           // åˆ†å²15: T/F

// å¥åº·ãƒœãƒ¼ãƒŠã‚¹åˆ†å²
if (!hasRiskFactors && customer.hasHealthCertificate())  // åˆ†å²16: T/F

// æœ€ä½ä¿é™ºæ–™åˆ†å²
if (finalPremium < minimumPremium)                // åˆ†å²17: T/F
```

**ç·åˆ†å²æ•°**: 34åˆ†å²ï¼ˆ17ç®‡æ‰€ Ã— 2ï¼ˆT/Fï¼‰ï¼‰

#### ã‚¹ãƒ†ãƒƒãƒ—2: å®Ÿå‹™ã‚’è€ƒæ…®ã—ãŸãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹è¨­è¨ˆ

### âœ… è§£ç­”ï¼šå®Ÿå‹™ãƒ¬ãƒ™ãƒ«ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹

```java
@Test
public void testCalculatePremium_ComprehensiveBranchCoverage() {
    InsurancePremiumCalculator calculator = new InsurancePremiumCalculator();
    
    // === å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆ ===
    
    // TC1: nullå…¥åŠ›ï¼ˆåˆ†å²1-Trueï¼‰
    PremiumResult result1 = calculator.calculatePremium(null, policy);
    assertFalse(result1.isSuccess());
    assertEquals("Invalid input", result1.getMessage());
    
    // TC2: å¹´é½¢ç¯„å›²å¤–ï¼ˆåˆ†å²2-Trueï¼‰
    Customer underageCustomer = createCustomer(17, false, false, "office", 2, false);
    PremiumResult result2 = calculator.calculatePremium(underageCustomer, policy);
    assertFalse(result2.isSuccess());
    assertEquals("Age out of range", result2.getMessage());
    
    // === å¹´é½¢å±¤åˆ¥ãƒ†ã‚¹ãƒˆ ===
    
    // TC3: é«˜é½¢è€…ï¼ˆ65æ­³ä»¥ä¸Šï¼‰- åˆ†å²3-True, ä»–ãƒªã‚¹ã‚¯ãªã—
    Customer elderly = createCustomer(70, false, false, "teacher", 1, true);
    PremiumResult result3 = calculator.calculatePremium(elderly, longTermPolicy);
    assertTrue(result3.isSuccess());
    double expectedElderly = 10000 * 1.5 * 0.9 * 0.85; // åŸºæœ¬*é«˜é½¢*é•·æœŸ*å¥åº·
    assertEquals(expectedElderly, result3.getPremium(), 0.01);
    
    // TC4: ä¸­å¹´ï¼ˆ40-64æ­³ï¼‰- åˆ†å²4-True, ãƒªã‚¹ã‚¯è·æ¥­
    Customer middleAge = createCustomer(45, true, false, "pilot", 4, false);
    PremiumResult result4 = calculator.calculatePremium(middleAge, mediumTermPolicy);
    assertTrue(result4.isSuccess());
    double expectedMiddle = 10000 * 1.2 * 1.3 * 2.0 * 0.95 * 0.9; // åŸºæœ¬*ä¸­å¹´*å–«ç…™*å±é™ºè·æ¥­*ä¸­æœŸ*å®¶æ—
    assertEquals(expectedMiddle, result4.getPremium(), 0.01);
    
    // TC5: è‹¥å¹´æˆäººï¼ˆ25-39æ­³ï¼‰- åˆ†å²5-True, æ¨™æº–ã‚±ãƒ¼ã‚¹
    Customer youngAdult = createCustomer(30, false, false, "engineer", 2, false);
    PremiumResult result5 = calculator.calculatePremium(youngAdult, shortTermPolicy);
    assertTrue(result5.isSuccess());
    double expectedYoung = 10000 * 1.0 * 0.95; // åŸºæœ¬*æ¨™æº–*å®¶æ—2äºº
    assertEquals(expectedYoung, result5.getPremium(), 0.01);
    
    // TC6: è‹¥å¹´è€…ï¼ˆ18-24æ­³ï¼‰- åˆ†å²6å®Ÿè¡Œ, æœ€ä½ä¿é™ºæ–™é©ç”¨
    Customer youth = createCustomer(20, false, false, null, 1, true);
    PremiumResult result6 = calculator.calculatePremium(youth, shortTermPolicy);
    assertTrue(result6.isSuccess());
    double expectedYouth = Math.max(10000 * 0.8 * 0.85, 1000); // æœ€ä½ä¿é™ºæ–™é©ç”¨
    assertEquals(1000.0, result6.getPremium(), 0.01); // æœ€ä½ä¿é™ºæ–™
    
    // === ãƒªã‚¹ã‚¯è¦å› çµ„ã¿åˆã‚ã›ãƒ†ã‚¹ãƒˆ ===
    
    // TC7: å…¨ãƒªã‚¹ã‚¯è¦å› ï¼ˆåˆ†å²7-T, 8-T, 10-Tï¼‰
    Customer highRisk = createCustomer(35, true, true, "mining engineer", 1, false);
    PremiumResult result7 = calculator.calculatePremium(highRisk, longTermPolicy);
    assertTrue(result7.isSuccess());
    double expectedHighRisk = 10000 * 1.0 * 1.3 * 1.4 * 2.0 * 0.9; // å…¨ãƒªã‚¹ã‚¯è¦å› 
    assertEquals(expectedHighRisk, result7.getPremium(), 0.01);
    
    // TC8: ä¸­ãƒªã‚¹ã‚¯è·æ¥­ï¼ˆåˆ†å²11-Trueï¼‰
    Customer mediumRisk = createCustomer(35, false, false, "construction worker", 3, false);
    PremiumResult result8 = calculator.calculatePremium(mediumRisk, mediumTermPolicy);
    assertTrue(result8.isSuccess());
    double expectedMediumRisk = 10000 * 1.0 * 1.6 * 0.95; // ä¸­ãƒªã‚¹ã‚¯è·æ¥­
    assertEquals(expectedMediumRisk, result8.getPremium(), 0.01);
    
    // TC9: è·æ¥­nullï¼ˆåˆ†å²9-Falseï¼‰
    Customer noOccupation = createCustomer(35, false, false, null, 2, false);
    PremiumResult result9 = calculator.calculatePremium(noOccupation, shortTermPolicy);
    assertTrue(result9.isSuccess());
    double expectedNoOccupation = 10000 * 1.0 * 0.95; // è·æ¥­ãƒªã‚¹ã‚¯ãªã—
    assertEquals(expectedNoOccupation, result9.getPremium(), 0.01);
    
    // === å¢ƒç•Œå€¤ãƒ»ã‚¨ãƒƒã‚¸ã‚±ãƒ¼ã‚¹ãƒ†ã‚¹ãƒˆ ===
    
    // TC10: å¹´é½¢å¢ƒç•Œå€¤ï¼ˆ25æ­³ã¡ã‚‡ã†ã©ï¼‰
    Customer boundary25 = createCustomer(25, false, false, "office", 1, false);
    PremiumResult result10 = calculator.calculatePremium(boundary25, shortTermPolicy);
    double expected25 = 10000 * 1.0; // æ¨™æº–ãƒ¬ãƒ¼ãƒˆé©ç”¨
    assertEquals(expected25, result10.getPremium(), 0.01);
    
    // TC11: æœŸé–“å¢ƒç•Œå€¤ï¼ˆ30å¹´ã¡ã‚‡ã†ã©ï¼‰
    Policy boundary30Year = createPolicy(10000, 30);
    Customer standard = createCustomer(35, false, false, "office", 1, false);
    PremiumResult result11 = calculator.calculatePremium(standard, boundary30Year);
    double expected30Year = 10000 * 1.0 * 0.9; // é•·æœŸå‰²å¼•
    assertEquals(expected30Year, result11.getPremium(), 0.01);
}

// ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
private Customer createCustomer(int age, boolean smoker, boolean chronicDisease, 
                               String occupation, int familySize, boolean healthCert) {
    Customer customer = new Customer();
    customer.setAge(age);
    customer.setSmoker(smoker);
    customer.setChronicDisease(chronicDisease);
    customer.setOccupation(occupation);
    customer.setFamilySize(familySize);
    customer.setHealthCertificate(healthCert);
    return customer;
}

private Policy createPolicy(double basePremium, int termYears) {
    Policy policy = new Policy();
    policy.setBasePremium(basePremium);
    policy.setTermYears(termYears);
    return policy;
}
```

### ğŸ“Š å®Ÿå‹™ä¾¡å€¤ã®é«˜ã„ãƒ†ã‚¹ãƒˆè¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

#### ğŸ’¡ 1. ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®æ¤œè¨¼
- **å¹´é½¢å±¤åˆ¥ãƒ†ã‚¹ãƒˆ**: å®Ÿéš›ã®ä¿é™ºæ¥­ç•Œã®å¹´é½¢åŒºåˆ†ã«åŸºã¥ã
- **ãƒªã‚¹ã‚¯è¦å› ã®çµ„ã¿åˆã‚ã›**: ç¾å®Ÿçš„ãªãƒªã‚¹ã‚¯è©•ä¾¡ã‚·ãƒŠãƒªã‚ª
- **è·æ¥­ãƒªã‚¹ã‚¯ã®æ®µéšçš„ãƒ†ã‚¹ãƒˆ**: é«˜/ä¸­/ä½ãƒªã‚¹ã‚¯ã®ä»£è¡¨çš„è·æ¥­

#### ğŸ’¡ 2. å¢ƒç•Œå€¤ã®é‡ç‚¹ãƒ†ã‚¹ãƒˆ
- **å¹´é½¢å¢ƒç•Œ**: 18æ­³ã€25æ­³ã€40æ­³ã€65æ­³ã€100æ­³
- **æœŸé–“å¢ƒç•Œ**: 20å¹´ã€30å¹´
- **å®¶æ—ã‚µã‚¤ã‚ºå¢ƒç•Œ**: 2äººã€4äºº

#### ğŸ’¡ 3. è¨ˆç®—ç²¾åº¦ã®æ¤œè¨¼
- **è¤‡é›‘ãªä¿‚æ•°è¨ˆç®—**: è¤‡æ•°ã®å‰²å¢—ãƒ»å‰²å¼•ã®çµ„ã¿åˆã‚ã›
- **æœ€ä½ä¿é™ºæ–™ã®é©ç”¨**: è¨ˆç®—çµæœãŒæœ€ä½é¡ã‚’ä¸‹å›ã‚‹å ´åˆ
- **å°æ•°ç‚¹è¨ˆç®—ã®ç²¾åº¦**: æµ®å‹•å°æ•°ç‚¹ã®ä¸¸ã‚èª¤å·®å¯¾ç­–

---

## ğŸ’ª ä¸Šç´šæ¼”ç¿’ 2ï¼šç•°å¸¸ç³»ã¨ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ğŸ“ å•é¡Œï¼šãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ã‚·ã‚¹ãƒ†ãƒ 
ä»¥ä¸‹ã®ãƒ•ã‚¡ã‚¤ãƒ«å‡¦ç†ãƒ¡ã‚½ãƒƒãƒ‰ã§åˆ†å²ç¶²ç¾…ã‚’é”æˆã—ã€ç•°å¸¸ç³»ã‚’å«ã‚€å …ç‰¢ãªãƒ†ã‚¹ãƒˆã‚’è¨­è¨ˆã—ã¦ãã ã•ã„ã€‚

```java
public class FileProcessingService {
    
    public ProcessingResult processDataFile(String filePath, ProcessingOptions options) {
        ProcessingResult result = new ProcessingResult();
        
        // å…¥åŠ›æ¤œè¨¼
        if (filePath == null || filePath.trim().isEmpty()) {
            result.setSuccess(false);
            result.setMessage("File path is required");
            return result;
        }
        
        if (options == null) {
            options = new ProcessingOptions(); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆè¨­å®š
        }
        
        File file = new File(filePath);
        
        // ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ãƒã‚§ãƒƒã‚¯
        if (!file.exists()) {
            result.setSuccess(false);
            result.setMessage("File not found: " + filePath);
            return result;
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒã‚§ãƒƒã‚¯
        long fileSize = file.length();
        if (fileSize == 0) {
            result.setSuccess(false);
            result.setMessage("File is empty");
            return result;
        }
        
        // ã‚µã‚¤ã‚ºåˆ¶é™ãƒã‚§ãƒƒã‚¯
        long maxSize = options.getMaxFileSize();
        if (maxSize > 0 && fileSize > maxSize) {
            if (options.isAllowLargeFiles()) {
                // å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ã®è­¦å‘Š
                result.addWarning("Large file detected: " + fileSize + " bytes");
            } else {
                result.setSuccess(false);
                result.setMessage("File too large: " + fileSize + " bytes");
                return result;
            }
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒã‚§ãƒƒã‚¯
        String fileName = file.getName().toLowerCase();
        boolean isSupportedFormat = false;
        
        if (fileName.endsWith(".csv")) {
            isSupportedFormat = true;
            result.setFileType("CSV");
        } else if (fileName.endsWith(".json")) {
            isSupportedFormat = true;
            result.setFileType("JSON");
        } else if (fileName.endsWith(".xml")) {
            if (options.isXmlSupported()) {
                isSupportedFormat = true;
                result.setFileType("XML");
            } else {
                result.setSuccess(false);
                result.setMessage("XML format not supported");
                return result;
            }
        }
        
        if (!isSupportedFormat) {
            result.setSuccess(false);
            result.setMessage("Unsupported file format");
            return result;
        }
        
        // ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿å‡¦ç†
        int processedRecords = 0;
        int errorRecords = 0;
        
        try {
            List<String> lines = Files.readAllLines(file.toPath());
            
            for (String line : lines) {
                if (line == null || line.trim().isEmpty()) {
                    continue; // ç©ºè¡Œã‚¹ã‚­ãƒƒãƒ—
                }
                
                try {
                    // ãƒ‡ãƒ¼ã‚¿å‡¦ç†ï¼ˆä»®æƒ³ï¼‰
                    processRecord(line, options);
                    processedRecords++;
                } catch (DataProcessingException e) {
                    errorRecords++;
                    if (options.isStrictMode()) {
                        throw new ProcessingException("Strict mode: " + e.getMessage());
                    } else {
                        result.addWarning("Record processing failed: " + e.getMessage());
                    }
                }
            }
        } catch (IOException e) {
            result.setSuccess(false);
            result.setMessage("File reading failed: " + e.getMessage());
            return result;
        } catch (ProcessingException e) {
            result.setSuccess(false);
            result.setMessage(e.getMessage());
            return result;
        }
        
        // çµæœåˆ¤å®š
        if (processedRecords == 0) {
            result.setSuccess(false);
            result.setMessage("No valid records processed");
        } else {
            result.setSuccess(true);
            result.setMessage("Processing completed");
            result.setProcessedRecords(processedRecords);
            result.setErrorRecords(errorRecords);
            
            // ã‚¨ãƒ©ãƒ¼ç‡ãƒã‚§ãƒƒã‚¯
            double errorRate = (double) errorRecords / (processedRecords + errorRecords);
            if (errorRate > 0.1) { // 10%è¶…
                result.addWarning("High error rate: " + String.format("%.2f%%", errorRate * 100));
            }
        }
        
        return result;
    }
    
    private void processRecord(String record, ProcessingOptions options) 
            throws DataProcessingException {
        // ãƒ‡ãƒ¼ã‚¿å‡¦ç†ã®å®Ÿè£…ï¼ˆä»®æƒ³ï¼‰
        if (record.contains("ERROR")) {
            throw new DataProcessingException("Invalid record format");
        }
    }
}
```

### âœ… è§£ç­”ï¼šç•°å¸¸ç³»ã‚’å«ã‚€å®Œå…¨ãªåˆ†å²ç¶²ç¾…ãƒ†ã‚¹ãƒˆ

```java
@Test
public void testProcessDataFile_CompleteBranchCoverage() throws IOException {
    FileProcessingService service = new FileProcessingService();
    
    // === å…¥åŠ›æ¤œè¨¼ãƒ†ã‚¹ãƒˆ ===
    
    // TC1: null ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    ProcessingResult result1 = service.processDataFile(null, null);
    assertFalse(result1.isSuccess());
    assertEquals("File path is required", result1.getMessage());
    
    // TC2: ç©ºãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹
    ProcessingResult result2 = service.processDataFile("  ", null);
    assertFalse(result2.isSuccess());
    assertEquals("File path is required", result2.getMessage());
    
    // TC3: ãƒ•ã‚¡ã‚¤ãƒ«æœªå­˜åœ¨
    ProcessingResult result3 = service.processDataFile("nonexistent.csv", null);
    assertFalse(result3.isSuccess());
    assertTrue(result3.getMessage().contains("File not found"));
    
    // === ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºãƒ†ã‚¹ãƒˆ ===
    
    // TC4: ç©ºãƒ•ã‚¡ã‚¤ãƒ«
    File emptyFile = createTempFile("empty.csv", "");
    ProcessingResult result4 = service.processDataFile(emptyFile.getPath(), null);
    assertFalse(result4.isSuccess());
    assertEquals("File is empty", result4.getMessage());
    
    // TC5: å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆ¶é™è¶…éã€è¨±å¯ãªã—ï¼‰
    ProcessingOptions restrictiveOptions = new ProcessingOptions();
    restrictiveOptions.setMaxFileSize(100);
    restrictiveOptions.setAllowLargeFiles(false);
    
    File largeFile = createTempFile("large.csv", createLargeContent(200));
    ProcessingResult result5 = service.processDataFile(largeFile.getPath(), restrictiveOptions);
    assertFalse(result5.isSuccess());
    assertTrue(result5.getMessage().contains("File too large"));
    
    // TC6: å¤§ããªãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆåˆ¶é™è¶…éã€è¨±å¯ã‚ã‚Šï¼‰
    ProcessingOptions permissiveOptions = new ProcessingOptions();
    permissiveOptions.setMaxFileSize(100);
    permissiveOptions.setAllowLargeFiles(true);
    
    ProcessingResult result6 = service.processDataFile(largeFile.getPath(), permissiveOptions);
    assertTrue(result6.isSuccess());
    assertTrue(result6.getWarnings().stream().anyMatch(w -> w.contains("Large file detected")));
    
    // === ãƒ•ã‚¡ã‚¤ãƒ«å½¢å¼ãƒ†ã‚¹ãƒˆ ===
    
    // TC7: ã‚µãƒãƒ¼ãƒˆå½¢å¼ï¼ˆCSVï¼‰
    File csvFile = createTempFile("data.csv", "name,age\nJohn,25\nJane,30");
    ProcessingResult result7 = service.processDataFile(csvFile.getPath(), null);
    assertTrue(result7.isSuccess());
    assertEquals("CSV", result7.getFileType());
    assertEquals(2, result7.getProcessedRecords());
    
    // TC8: ã‚µãƒãƒ¼ãƒˆå½¢å¼ï¼ˆJSONï¼‰
    File jsonFile = createTempFile("data.json", "{\"name\":\"John\",\"age\":25}");
    ProcessingResult result8 = service.processDataFile(jsonFile.getPath(), null);
    assertTrue(result8.isSuccess());
    assertEquals("JSON", result8.getFileType());
    
    // TC9: XMLï¼ˆã‚µãƒãƒ¼ãƒˆã‚ã‚Šï¼‰
    ProcessingOptions xmlEnabledOptions = new ProcessingOptions();
    xmlEnabledOptions.setXmlSupported(true);
    
    File xmlFile = createTempFile("data.xml", "<root><item>test</item></root>");
    ProcessingResult result9 = service.processDataFile(xmlFile.getPath(), xmlEnabledOptions);
    assertTrue(result9.isSuccess());
    assertEquals("XML", result9.getFileType());
    
    // TC10: XMLï¼ˆã‚µãƒãƒ¼ãƒˆãªã—ï¼‰
    ProcessingOptions xmlDisabledOptions = new ProcessingOptions();
    xmlDisabledOptions.setXmlSupported(false);
    
    ProcessingResult result10 = service.processDataFile(xmlFile.getPath(), xmlDisabledOptions);
    assertFalse(result10.isSuccess());
    assertEquals("XML format not supported", result10.getMessage());
    
    // TC11: æœªã‚µãƒãƒ¼ãƒˆå½¢å¼
    File unsupportedFile = createTempFile("data.pdf", "PDF content");
    ProcessingResult result11 = service.processDataFile(unsupportedFile.getPath(), null);
    assertFalse(result11.isSuccess());
    assertEquals("Unsupported file format", result11.getMessage());
    
    // === ãƒ‡ãƒ¼ã‚¿å‡¦ç†ãƒ†ã‚¹ãƒˆ ===
    
    // TC12: ã‚¹ãƒˆãƒªã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ä¸­æ–­ï¼‰
    ProcessingOptions strictOptions = new ProcessingOptions();
    strictOptions.setStrictMode(true);
    
    File errorFile = createTempFile("error.csv", "good line\nERROR line\ngood line");
    ProcessingResult result12 = service.processDataFile(errorFile.getPath(), strictOptions);
    assertFalse(result12.isSuccess());
    assertTrue(result12.getMessage().contains("Strict mode"));
    
    // TC13: éã‚¹ãƒˆãƒªã‚¯ãƒˆãƒ¢ãƒ¼ãƒ‰ï¼ˆã‚¨ãƒ©ãƒ¼æ™‚ç¶™ç¶šï¼‰
    ProcessingOptions lenientOptions = new ProcessingOptions();
    lenientOptions.setStrictMode(false);
    
    ProcessingResult result13 = service.processDataFile(errorFile.getPath(), lenientOptions);
    assertTrue(result13.isSuccess());
    assertEquals(2, result13.getProcessedRecords());
    assertEquals(1, result13.getErrorRecords());
    assertTrue(result13.getWarnings().stream().anyMatch(w -> w.contains("Record processing failed")));
    
    // TC14: é«˜ã‚¨ãƒ©ãƒ¼ç‡ï¼ˆ10%è¶…ï¼‰
    File highErrorFile = createTempFile("high_error.csv", 
        "good1\nERROR1\nERROR2\nERROR3\nERROR4\nERROR5\nERROR6\ngood2");
    ProcessingResult result14 = service.processDataFile(highErrorFile.getPath(), lenientOptions);
    assertTrue(result14.isSuccess());
    assertTrue(result14.getWarnings().stream().anyMatch(w -> w.contains("High error rate")));
    
    // TC15: æœ‰åŠ¹ãƒ¬ã‚³ãƒ¼ãƒ‰ãªã—
    File noValidFile = createTempFile("no_valid.csv", "\n\nERROR\nERROR\n\n");
    ProcessingResult result15 = service.processDataFile(noValidFile.getPath(), lenientOptions);
    assertFalse(result15.isSuccess());
    assertEquals("No valid records processed", result15.getMessage());
    
    // === IOException ãƒ†ã‚¹ãƒˆ ===
    
    // TC16: èª­ã¿è¾¼ã¿æ¨©é™ãªã—ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆIOExceptionï¼‰
    File readOnlyFile = createTempFile("readonly.csv", "test data");
    readOnlyFile.setReadable(false);
    
    ProcessingResult result16 = service.processDataFile(readOnlyFile.getPath(), null);
    assertFalse(result16.isSuccess());
    assertTrue(result16.getMessage().contains("File reading failed"));
    
    // ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
    readOnlyFile.setReadable(true);
    cleanupTempFiles();
}

// ãƒ†ã‚¹ãƒˆãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰
private File createTempFile(String name, String content) throws IOException {
    File tempFile = File.createTempFile("test_", "_" + name);
    tempFile.deleteOnExit();
    Files.write(tempFile.toPath(), content.getBytes());
    return tempFile;
}

private String createLargeContent(int sizeBytes) {
    StringBuilder sb = new StringBuilder();
    while (sb.length() < sizeBytes) {
        sb.append("test data line\n");
    }
    return sb.toString();
}
```

---

## ğŸ¯ å®Ÿå‹™ãƒ¬ãƒ™ãƒ«åˆ†å²ç¶²ç¾…ã®æˆåŠŸãƒã‚¤ãƒ³ãƒˆ

### ğŸ’¡ 1. ãƒ“ã‚¸ãƒã‚¹ã‚·ãƒŠãƒªã‚ªã®å„ªå…ˆåº¦ä»˜ã‘
- **é«˜é »åº¦ãƒ‘ã‚¹**: æ­£å¸¸ç³»ã®ä¸»è¦ãªæ¥­å‹™ãƒ•ãƒ­ãƒ¼
- **é«˜ãƒªã‚¹ã‚¯ãƒ‘ã‚¹**: ã‚¨ãƒ©ãƒ¼æ™‚ã®å½±éŸ¿ãŒå¤§ãã„åˆ†å²
- **å¢ƒç•Œæ¡ä»¶**: ä»•æ§˜ã®å¢ƒç•Œå€¤ã§ã®å‹•ä½œ

### ğŸ’¡ 2. åŠ¹ç‡çš„ãªãƒ†ã‚¹ãƒˆè¨­è¨ˆ
- **è¤‡æ•°åˆ†å²ã®åŒæ™‚ã‚«ãƒãƒ¼**: 1ã¤ã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã§è¤‡æ•°åˆ†å²ã‚’å®Ÿè¡Œ
- **ä»£è¡¨å€¤ã®é¸å®š**: åŒå€¤ã‚¯ãƒ©ã‚¹å†…ã®é©åˆ‡ãªä»£è¡¨å€¤é¸æŠ
- **ãƒ‡ãƒ¼ã‚¿ãƒ‰ãƒªãƒ–ãƒ³ãƒ†ã‚¹ãƒˆ**: ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿åŒ–ã«ã‚ˆã‚‹åŠ¹ç‡åŒ–

### ğŸ’¡ 3. ä¿å®ˆæ€§ã®è€ƒæ…®
- **ãƒ˜ãƒ«ãƒ‘ãƒ¼ãƒ¡ã‚½ãƒƒãƒ‰**: ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ä½œæˆã®å…±é€šåŒ–
- **æ˜ç¢ºãªå‘½å**: ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã®æ„å›³ãŒåˆ†ã‹ã‚‹å‘½å
- **é©åˆ‡ãªã‚¢ã‚µãƒ¼ã‚·ãƒ§ãƒ³**: æœŸå¾…å€¤ã®æ˜ç¢ºãªæ¤œè¨¼

### ğŸ’¡ 4. å®Ÿè¡ŒåŠ¹ç‡ã®æœ€é©åŒ–
- **ãƒ†ã‚¹ãƒˆåˆ†å‰²**: ç‹¬ç«‹æ€§ã‚’ä¿ã£ãŸé©åˆ‡ãªãƒ†ã‚¹ãƒˆåˆ†å‰²
- **ãƒªã‚½ãƒ¼ã‚¹ç®¡ç†**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ»DBæ¥ç¶šç­‰ã®é©åˆ‡ãªã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- **ä¸¦åˆ—å®Ÿè¡Œ**: ä¸¦åˆ—å®Ÿè¡Œå¯èƒ½ãªãƒ†ã‚¹ãƒˆè¨­è¨ˆ

---

## ğŸš€ æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

ä¸Šç´šæ¼”ç¿’ã‚’å®Œäº†ã—ãŸã‚‰ã€ã€Œ05_è¿½åŠ æ¼”ç¿’ãƒ»è£œå¼·ç·´ç¿’.mdã€ã§æ›´ãªã‚‹ã‚¹ã‚­ãƒ«å‘ä¸Šã‚’å›³ã‚Šã€æœ€çµ‚çš„ã«ã€Œ06_å®Ÿå‹™é©ç”¨ã‚¬ã‚¤ãƒ‰.mdã€ã§å®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®æ´»ç”¨æ–¹æ³•ã‚’å­¦ç¿’ã—ã¾ã—ã‚‡ã†ã€‚

å®Ÿå‹™ãƒ¬ãƒ™ãƒ«ã®åˆ†å²ç¶²ç¾…ã‚¹ã‚­ãƒ«ãŒèº«ã«ã¤ã„ãŸã‚‰ã€æ¡ä»¶ç¶²ç¾…ã‚„MC/DCç­‰ã®ã‚ˆã‚Šé«˜åº¦ãªæŠ€æ³•ã¸ã®æŒ‘æˆ¦ã‚‚å¯èƒ½ã§ã™ï¼
