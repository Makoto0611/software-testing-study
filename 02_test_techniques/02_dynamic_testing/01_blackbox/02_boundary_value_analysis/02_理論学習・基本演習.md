# 🔬 境界値分析 理論学習・基本演習

## 📚 この段階のゴール

**境界値分析を実際に使えるようになる**
- [ ] 仕様から境界値を特定できる
- [ ] テストケースを作成できる
- [ ] PHPUnitで実装できる

**⏰ 推奨時間**: 約60分（理論15分 + 演習45分）

---

## 🎯 境界値分析とは【3分で理解】

### 💡 **核心概念**

```
境界値 = 有効範囲と無効範囲の境目付近の値
なぜテストする？ → バグは境界で起こりやすい
```

### 📊 **2つの方法**

#### **2点境界値テスト**
```
範囲: 1-100
テスト値: 0, 1, 100, 101
→ 境界の両側をテスト
```

#### **3点境界値テスト**
```
範囲: 1-100  
テスト値: 0, 1, 2, 99, 100, 101
→ 境界+その前後もテスト（より確実）
```

### 🔄 **同値分割との関係**

```
1. 同値分割で範囲を分ける
   └→ 無効/有効/無効

2. 境界値分析で境目を特定
   └→ 境界付近の値を抽出

3. テストケースを作成
   └→ 同値クラスの代表値 + 境界値
```

**理論はここまで！ 実際にやってみましょう 🚀**

---

## 🎯 演習1: ウォーミングアップ【難易度: ★☆☆】

### 📝 仕様
```
割引クーポンコードの文字数チェック
- 有効: 8文字ちょうど
- 無効: 8文字以外
```

### 課題
**Q1. 2点境界値を答えてください**
```
境界値: [          ]
```

<details>
<summary>💡 解答</summary>

```
7文字, 8文字, 9文字

理由:
- 7文字（境界-1）→ 無効
- 8文字（境界）→ 有効
- 9文字（境界+1）→ 無効
```
</details>

---

## 🎯 演習2: 基本パターン【難易度: ★☆☆】

### 📝 仕様
```
年齢入力
- 有効範囲: 20歳以上65歳以下
- 範囲外: エラーメッセージ
```

### 課題
**Q1. 3点境界値を特定してください**
```
下限境界: [                    ]
上限境界: [                    ]
```

**Q2. テストケース表を完成させてください**
| ID | 年齢 | 期待結果 | 境界種別 |
|----|------|----------|----------|
| TC001 | | エラー | 下限-1 |
| TC002 | | OK | 下限 |
| TC003 | | OK | 下限+1 |
| TC004 | | OK | 上限-1 |
| TC005 | | OK | 上限 |
| TC006 | | エラー | 上限+1 |

<details>
<summary>💡 解答</summary>

**Q1. 3点境界値**
```
下限境界: 19歳, 20歳, 21歳
上限境界: 64歳, 65歳, 66歳
```

**Q2. テストケース表**
| ID | 年齢 | 期待結果 | 境界種別 |
|----|------|----------|----------|
| TC001 | 19 | エラー | 下限-1 |
| TC002 | 20 | OK | 下限 |
| TC003 | 21 | OK | 下限+1 |
| TC004 | 64 | OK | 上限-1 |
| TC005 | 65 | OK | 上限 |
| TC006 | 66 | エラー | 上限+1 |
</details>

---

## 🎯 演習3: PHPUnitで実装【難易度: ★★☆】

### 📝 仕様
```php
// 商品価格のバリデーション
class PriceValidator
{
    public function validate(int $price): bool
    {
        return $price >= 100 && $price <= 10000;
    }
}
```

### 課題
**Q1. 2点境界値テストケースを書いてください**

```php
use PHPUnit\Framework\TestCase;

class PriceValidatorTest extends TestCase
{
    private PriceValidator $validator;

    protected function setUp(): void
    {
        $this->validator = new PriceValidator();
    }

    /** @test */
    public function 下限境界マイナス1_無効()
    {
        // [ここに実装]
    }

    /** @test */
    public function 下限境界_有効()
    {
        // [ここに実装]
    }

    /** @test */
    public function 上限境界_有効()
    {
        // [ここに実装]
    }

    /** @test */
    public function 上限境界プラス1_無効()
    {
        // [ここに実装]
    }
}
```

<details>
<summary>💡 解答</summary>

```php
use PHPUnit\Framework\TestCase;

class PriceValidatorTest extends TestCase
{
    private PriceValidator $validator;

    protected function setUp(): void
    {
        $this->validator = new PriceValidator();
    }

    /** @test */
    public function 下限境界マイナス1_無効()
    {
        $this->assertFalse($this->validator->validate(99));
    }

    /** @test */
    public function 下限境界_有効()
    {
        $this->assertTrue($this->validator->validate(100));
    }

    /** @test */
    public function 上限境界_有効()
    {
        $this->assertTrue($this->validator->validate(10000));
    }

    /** @test */
    public function 上限境界プラス1_無効()
    {
        $this->assertFalse($this->validator->validate(10001));
    }
}
```
</details>

---

## 🎯 演習4: 文字列長の境界値【難易度: ★★☆】

### 📝 仕様
```php
// パスワードの文字数チェック
class PasswordValidator
{
    public function validateLength(string $password): bool
    {
        $length = mb_strlen($password);
        return $length >= 8 && $length <= 20;
    }
}
```

### 課題
**Q1. 3点境界値を特定してください**
```
下限境界: [                    ]
上限境界: [                    ]
```

**Q2. PHPUnitテストを実装してください**

```php
class PasswordValidatorTest extends TestCase
{
    // [6つのテストメソッドを実装]
}
```

<details>
<summary>💡 解答</summary>

**Q1. 3点境界値**
```
下限境界: 7文字, 8文字, 9文字
上限境界: 19文字, 20文字, 21文字
```

**Q2. PHPUnit実装**
```php
class PasswordValidatorTest extends TestCase
{
    private PasswordValidator $validator;

    protected function setUp(): void
    {
        $this->validator = new PasswordValidator();
    }

    /** @test */
    public function 長さ7文字_無効()
    {
        $this->assertFalse($this->validator->validateLength('1234567'));
    }

    /** @test */
    public function 長さ8文字_有効()
    {
        $this->assertTrue($this->validator->validateLength('12345678'));
    }

    /** @test */
    public function 長さ9文字_有効()
    {
        $this->assertTrue($this->validator->validateLength('123456789'));
    }

    /** @test */
    public function 長さ19文字_有効()
    {
        $this->assertTrue($this->validator->validateLength(str_repeat('a', 19)));
    }

    /** @test */
    public function 長さ20文字_有効()
    {
        $this->assertTrue($this->validator->validateLength(str_repeat('a', 20)));
    }

    /** @test */
    public function 長さ21文字_無効()
    {
        $this->assertFalse($this->validator->validateLength(str_repeat('a', 21)));
    }
}
```
</details>

---

## 🎯 演習5: 日付の境界値【難易度: ★★☆】

### 📝 仕様
```
キャンペーン期間チェック
- 開始: 2025年1月1日
- 終了: 2025年12月31日
- 期間内: true
- 期間外: false
```

### 課題
**Q1. 境界日を特定してください**
```
開始日境界: [                         ]
終了日境界: [                         ]
```

**Q2. テストすべき日付を6つ挙げてください**
```
1. [              ]
2. [              ]
3. [              ]
4. [              ]
5. [              ]
6. [              ]
```

<details>
<summary>💡 解答</summary>

**Q1. 境界日**
```
開始日境界: 2024/12/31, 2025/1/1, 2025/1/2
終了日境界: 2025/12/30, 2025/12/31, 2026/1/1
```

**Q2. テスト日付**
```
1. 2024/12/31 → false（開始前日）
2. 2025/1/1 → true（開始日）
3. 2025/1/2 → true（開始翌日）
4. 2025/12/30 → true（終了前日）
5. 2025/12/31 → true（終了日）
6. 2026/1/1 → false（終了翌日）
```

**PHPUnit実装例**
```php
class CampaignPeriodTest extends TestCase
{
    /** @test */
    public function 開始日前日_期間外()
    {
        $checker = new CampaignPeriodChecker();
        $this->assertFalse($checker->isInPeriod('2024-12-31'));
    }

    /** @test */
    public function 開始日_期間内()
    {
        $checker = new CampaignPeriodChecker();
        $this->assertTrue($checker->isInPeriod('2025-01-01'));
    }

    // 残り4テストも同様に実装
}
```
</details>

---

## 🎯 演習6: 複数条件の境界値【難易度: ★★★】

### 📝 仕様
```php
// 商品検索フィルタ
class ProductFilter
{
    // 価格: 1000円以上50000円以下
    // 在庫数: 1個以上999個以下
    public function isValid(int $price, int $stock): bool
    {
        $priceValid = $price >= 1000 && $price <= 50000;
        $stockValid = $stock >= 1 && $stock <= 999;
        return $priceValid && $stockValid;
    }
}
```

### 課題
**Q1. 各パラメータの2点境界値を特定してください**
```
価格境界値: [                              ]
在庫境界値: [                              ]
```

**Q2. 組み合わせテストケースを4パターン作成してください**
```
1. (価格=?, 在庫=?) → 期待結果: ?
2. (価格=?, 在庫=?) → 期待結果: ?
3. (価格=?, 在庫=?) → 期待結果: ?
4. (価格=?, 在庫=?) → 期待結果: ?
```

**Q3. PHPUnitで実装してください**

<details>
<summary>💡 解答</summary>

**Q1. 境界値**
```
価格境界値: 999, 1000, 50000, 50001
在庫境界値: 0, 1, 999, 1000
```

**Q2. 組み合わせテストケース**
```
1. (価格=999, 在庫=0) → false（両方とも境界外）
2. (価格=1000, 在庫=1) → true（両方とも境界内）
3. (価格=50000, 在庫=999) → true（両方とも境界内）
4. (価格=50001, 在庫=1000) → false（両方とも境界外）
```

**Q3. PHPUnit実装**
```php
class ProductFilterTest extends TestCase
{
    private ProductFilter $filter;

    protected function setUp(): void
    {
        $this->filter = new ProductFilter();
    }

    /** @test */
    public function 両方が下限境界外_無効()
    {
        $this->assertFalse($this->filter->isValid(999, 0));
    }

    /** @test */
    public function 両方が下限境界_有効()
    {
        $this->assertTrue($this->filter->isValid(1000, 1));
    }

    /** @test */
    public function 両方が上限境界_有効()
    {
        $this->assertTrue($this->filter->isValid(50000, 999));
    }

    /** @test */
    public function 両方が上限境界外_無効()
    {
        $this->assertFalse($this->filter->isValid(50001, 1000));
    }

    /** @test データ駆動テストパターン */
    /** @dataProvider 境界値データプロバイダ */
    public function 境界値パターン網羅テスト(int $price, int $stock, bool $expected)
    {
        $this->assertEquals($expected, $this->filter->isValid($price, $stock));
    }

    public function 境界値データプロバイダ(): array
    {
        return [
            '価格下限-1' => [999, 500, false],
            '価格下限' => [1000, 500, true],
            '価格上限' => [50000, 500, true],
            '価格上限+1' => [50001, 500, false],
            '在庫下限-1' => [25000, 0, false],
            '在庫下限' => [25000, 1, true],
            '在庫上限' => [25000, 999, true],
            '在庫上限+1' => [25000, 1000, false],
        ];
    }
}
```
</details>

---

## 🎯 演習7: ファイルサイズの境界値【難易度: ★★☆】

### 📝 仕様
```
画像アップロード
- 最小サイズ: 100KB
- 最大サイズ: 5MB (5120KB)
- 範囲外: エラー
```

### 課題
**自分でPHPUnitテストを最初から書いてみてください**

ヒント:
- FileValidatorクラスを想定
- 2点境界値テスト
- 4つのテストメソッド

```php
// [ここに実装]
```

<details>
<summary>💡 解答例</summary>

```php
class FileValidator
{
    private const MIN_SIZE_KB = 100;
    private const MAX_SIZE_KB = 5120;

    public function validateSize(int $sizeKB): bool
    {
        return $sizeKB >= self::MIN_SIZE_KB && $sizeKB <= self::MAX_SIZE_KB;
    }
}

class FileValidatorTest extends TestCase
{
    private FileValidator $validator;

    protected function setUp(): void
    {
        $this->validator = new FileValidator();
    }

    /** @test */
    public function サイズ99KB_無効()
    {
        $this->assertFalse($this->validator->validateSize(99));
    }

    /** @test */
    public function サイズ100KB_有効()
    {
        $this->assertTrue($this->validator->validateSize(100));
    }

    /** @test */
    public function サイズ5120KB_有効()
    {
        $this->assertTrue($this->validator->validateSize(5120));
    }

    /** @test */
    public function サイズ5121KB_無効()
    {
        $this->assertFalse($this->validator->validateSize(5121));
    }
}
```
</details>

---

## 🎯 演習8: 配列インデックスの境界値【難易度: ★★★】

### 📝 仕様
```php
// ページネーション
class Paginator
{
    private array $items;
    
    public function __construct(array $items)
    {
        $this->items = $items;
    }
    
    // ページ番号は1から始まる（1-indexed）
    // 1ページあたり10件表示
    public function getPage(int $pageNumber): ?array
    {
        $startIndex = ($pageNumber - 1) * 10;
        
        if ($startIndex < 0 || $startIndex >= count($this->items)) {
            return null;
        }
        
        return array_slice($this->items, $startIndex, 10);
    }
}
```

### 課題
**Q1. 100件のデータがある場合の境界値を考えてください**
```
最小ページ番号の境界: [              ]
最大ページ番号の境界: [              ]
```

**Q2. PHPUnitテストを実装してください**

<details>
<summary>💡 解答</summary>

**Q1. 境界値**
```
最小ページ番号の境界: 0, 1, 2
最大ページ番号の境界: 9, 10, 11

理由:
- 100件 ÷ 10件/ページ = 10ページ
- ページ0: 無効（1始まり）
- ページ1: 有効（最初のページ）
- ページ10: 有効（最後のページ、91-100件目）
- ページ11: 無効（範囲外）
```

**Q2. PHPUnit実装**
```php
class PaginatorTest extends TestCase
{
    private Paginator $paginator;

    protected function setUp(): void
    {
        // 100件のテストデータ
        $items = range(1, 100);
        $this->paginator = new Paginator($items);
    }

    /** @test */
    public function ページ0_無効()
    {
        $this->assertNull($this->paginator->getPage(0));
    }

    /** @test */
    public function ページ1_有効()
    {
        $result = $this->paginator->getPage(1);
        $this->assertNotNull($result);
        $this->assertCount(10, $result);
        $this->assertEquals(1, $result[0]);
    }

    /** @test */
    public function ページ2_有効()
    {
        $result = $this->paginator->getPage(2);
        $this->assertNotNull($result);
        $this->assertEquals(11, $result[0]);
    }

    /** @test */
    public function ページ9_有効()
    {
        $result = $this->paginator->getPage(9);
        $this->assertNotNull($result);
        $this->assertEquals(81, $result[0]);
    }

    /** @test */
    public function ページ10_有効_最後のページ()
    {
        $result = $this->paginator->getPage(10);
        $this->assertNotNull($result);
        $this->assertCount(10, $result);
        $this->assertEquals(91, $result[0]);
    }

    /** @test */
    public function ページ11_無効()
    {
        $this->assertNull($this->paginator->getPage(11));
    }
}
```
</details>

---

## 🎯 演習9: 同値分割との統合【難易度: ★★★】

### 📝 仕様
```
会員ランク判定
- Bronze: ポイント0-999
- Silver: ポイント1000-4999
- Gold: ポイント5000-9999
- Platinum: ポイント10000以上
```

### 課題
**Q1. 同値分割してください**
```
同値クラス1: [                    ]
同値クラス2: [                    ]
同値クラス3: [                    ]
同値クラス4: [                    ]
```

**Q2. 各境界の境界値を特定してください（3点境界値）**
```
Bronze-Silver境界: [              ]
Silver-Gold境界: [              ]
Gold-Platinum境界: [              ]
```

**Q3. 境界値テストケースを作成してください**

<details>
<summary>💡 解答</summary>

**Q1. 同値分割**
```
同値クラス1: 0-999 (Bronze)
同値クラス2: 1000-4999 (Silver)
同値クラス3: 5000-9999 (Gold)
同値クラス4: 10000以上 (Platinum)
```

**Q2. 3点境界値**
```
Bronze-Silver境界: 999, 1000, 1001
Silver-Gold境界: 4999, 5000, 5001
Gold-Platinum境界: 9999, 10000, 10001
```

**Q3. PHPUnit実装**
```php
class MemberRankTest extends TestCase
{
    private MemberRankCalculator $calculator;

    protected function setUp(): void
    {
        $this->calculator = new MemberRankCalculator();
    }

    /** @test Bronze-Silver境界 */
    public function ポイント999_Bronze()
    {
        $this->assertEquals('Bronze', $this->calculator->getRank(999));
    }

    /** @test */
    public function ポイント1000_Silver()
    {
        $this->assertEquals('Silver', $this->calculator->getRank(1000));
    }

    /** @test */
    public function ポイント1001_Silver()
    {
        $this->assertEquals('Silver', $this->calculator->getRank(1001));
    }

    /** @test Silver-Gold境界 */
    public function ポイント4999_Silver()
    {
        $this->assertEquals('Silver', $this->calculator->getRank(4999));
    }

    /** @test */
    public function ポイント5000_Gold()
    {
        $this->assertEquals('Gold', $this->calculator->getRank(5000));
    }

    /** @test */
    public function ポイント5001_Gold()
    {
        $this->assertEquals('Gold', $this->calculator->getRank(5001));
    }

    /** @test Gold-Platinum境界 */
    public function ポイント9999_Gold()
    {
        $this->assertEquals('Gold', $this->calculator->getRank(9999));
    }

    /** @test */
    public function ポイント10000_Platinum()
    {
        $this->assertEquals('Platinum', $this->calculator->getRank(10000));
    }

    /** @test */
    public function ポイント10001_Platinum()
    {
        $this->assertEquals('Platinum', $this->calculator->getRank(10001));
    }

    /** @test 代表値テスト（同値分割） */
    public function ポイント500_Bronze()
    {
        $this->assertEquals('Bronze', $this->calculator->getRank(500));
    }

    /** @test */
    public function ポイント3000_Silver()
    {
        $this->assertEquals('Silver', $this->calculator->getRank(3000));
    }

    /** @test */
    public function ポイント7500_Gold()
    {
        $this->assertEquals('Gold', $this->calculator->getRank(7500));
    }

    /** @test */
    public function ポイント15000_Platinum()
    {
        $this->assertEquals('Platinum', $this->calculator->getRank(15000));
    }
}
```
</details>

---

## 🎯 演習10: 実践総合問題【難易度: ★★★】

### 📝 仕様
```
ホテル予約システムの宿泊日数チェック
- 最小宿泊日数: 1泊
- 最大宿泊日数: 30泊
- 長期割引: 7泊以上で10%割引
- 団体割引: 14泊以上で20%割引
```

### 課題
**これまでの学習を活かして、完全なテストスイートを作成してください**

1. 同値分割を実行
2. すべての境界値を特定
3. PHPUnitテストを実装
4. データプロバイダも活用

```php
// [ここに完全な実装を書いてください]
```

<details>
<summary>💡 解答例</summary>

```php
class HotelReservation
{
    public function calculateDiscount(int $nights): int
    {
        if ($nights < 1 || $nights > 30) {
            throw new InvalidArgumentException('宿泊日数は1-30泊の範囲で指定してください');
        }

        if ($nights >= 14) {
            return 20;
        } elseif ($nights >= 7) {
            return 10;
        }

        return 0;
    }
}

class HotelReservationTest extends TestCase
{
    private HotelReservation $reservation;

    protected function setUp(): void
    {
        $this->reservation = new HotelReservation();
    }

    /** @test 最小宿泊日数の境界値 */
    public function 宿泊0泊_例外()
    {
        $this->expectException(InvalidArgumentException::class);
        $this->reservation->calculateDiscount(0);
    }

    /** @test */
    public function 宿泊1泊_割引なし()
    {
        $this->assertEquals(0, $this->reservation->calculateDiscount(1));
    }

    /** @test */
    public function 宿泊2泊_割引なし()
    {
        $this->assertEquals(0, $this->reservation->calculateDiscount(2));
    }

    /** @test 長期割引境界値 */
    public function 宿泊6泊_割引なし()
    {
        $this->assertEquals(0, $this->reservation->calculateDiscount(6));
    }

    /** @test */
    public function 宿泊7泊_10パーセント割引()
    {
        $this->assertEquals(10, $this->reservation->calculateDiscount(7));
    }

    /** @test */
    public function 宿泊8泊_10パーセント割引()
    {
        $this->assertEquals(10, $this->reservation->calculateDiscount(8));
    }

    /** @test 団体割引境界値 */
    public function 宿泊13泊_10パーセント割引()
    {
        $this->assertEquals(10, $this->reservation->calculateDiscount(13));
    }

    /** @test */
    public function 宿泊14泊_20パーセント割引()
    {
        $this->assertEquals(20, $this->reservation->calculateDiscount(14));
    }

    /** @test */
    public function 宿泊15泊_20パーセント割引()
    {
        $this->assertEquals(20, $this->reservation->calculateDiscount(15));
    }

    /** @test 最大宿泊日数の境界値 */
    public function 宿泊29泊_20パーセント割引()
    {
        $this->assertEquals(20, $this->reservation->calculateDiscount(29));
    }

    /** @test */
    public function 宿泊30泊_20パーセント割引()
    {
        $this->assertEquals(20, $this->reservation->calculateDiscount(30));
    }

    /** @test */
    public function 宿泊31泊_例外()
    {
        $this->expectException(InvalidArgumentException::class);
        $this->reservation->calculateDiscount(31);
    }

    /** @test データ駆動テスト */
    /** @dataProvider 宿泊日数割引パターン */
    public function 宿泊日数ごとの割引率検証(int $nights, int $expectedDiscount)
    {
        $this->assertEquals($expectedDiscount, $this->reservation->calculateDiscount($nights));
    }

    public function 宿泊日数割引パターン(): array
    {
        return [
            '1泊' => [1, 0],
            '3泊' => [3, 0],
            '6泊_境界' => [6, 0],
            '7泊_長期割引開始' => [7, 10],
            '10泊_長期割引' => [10, 10],
            '13泊_境界' => [13, 10],
            '14泊_団体割引開始' => [14, 20],
            '20泊_団体割引' => [20, 20],
            '30泊_上限' => [30, 20],
        ];
    }
}
```
</details>

---

## 📊 学習成果の確認

### ✅ **自己評価チェックリスト**

#### **理論理解度**
- [ ] 境界値分析の目的を理解した
- [ ] 2点と3点の違いを理解した
- [ ] 同値分割との関係を理解した

#### **実践スキル**
- [ ] 仕様から境界値を特定できる
- [ ] テストケース表を作成できる
- [ ] PHPUnitで実装できる
- [ ] データプロバイダを使える

#### **演習達成度**
```
演習1-3: [  /3] 基本パターン
演習4-6: [  /3] 実装練習
演習7-9: [  /3] 複雑パターン
演習10: [  /1] 総合問題

合計: [  /10]
```

### 📝 **振り返り記録**

**できたこと**
```
例:
- 基本的な境界値の特定
- PHPUnitでのテスト実装
- データプロバイダの活用
```

**難しかったこと**
```
例:
- 複数条件の組み合わせ
- 日付の境界値
- 配列インデックスの考え方
```

**次に強化したいスキル**
```
例:
- より複雑な仕様での適用
- パフォーマンステストの境界値
- 例外処理の境界値
```

---

## 🚀 次のステップ

**この段階を完了したら**:
→ `03_習得レベル確認.md` で客観的評価

**到達基準**:
- 演習10問中8問以上正解
- PHPUnitで実装できる
- 同値分割と組み合わせられる

**💪 お疲れ様でした！実際に手を動かすことで理解が深まったはずです 🎉**