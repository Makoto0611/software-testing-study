# 🎯 同値分割法 理論学習・基本演習

## 📋 このファイルを読む目的
**実務で即座に使える同値分割のスキル**を、理論と演習を通じて完全に習得する

## ⏰ 30分後のあなた
✅ 同値分割の5ステップ手順を完璧にマスター
✅ 有効・無効同値クラスを正確に特定できる
✅ 基本的な仕様から同値分割を自力で実行できる
✅ Laravel等の実務レベルの演習をクリアできる

## 👤 読むべき人
同値分割の具体的な実行方法を学びたい人、実際に手を動かして習得したい人

## 📈 具体的な成果物
- 同値分割の5ステップ実行シート
- 基本演習3問の完答
- 実務レベル演習1問のクリア
- 自分の業務での適用イメージ

---

## 📚 同値分割の理論基盤

### 🔍 同値分割の数学的基礎

#### 📊 集合論との関係
**同値関係**: 入力領域Dにおいて、以下3つの性質を満たす関係R

1. **反射律**: 任意のx∈Dに対してxRx  
   → 自分自身とは必ず同値
   
2. **対称律**: xRy ⟹ yRx  
   → AとBが同値なら、BとAも同値
   
3. **推移律**: xRy ∧ yRz ⟹ xRz  
   → AとBが同値、BとCが同値なら、AとCも同値

**同値クラス**: 同値関係Rによって分割されたDの部分集合

#### 🎯 テストにおける同値関係
**定義**: 2つの入力値が「同じ処理結果を生成する」関係

**具体例**: 年齢による会員登録チェック
```
仕様: 18歳以上65歳以下のみ登録可能

同値関係:
- 入力値 20歳 と 30歳 → 同じ結果「登録可能」（同値）
- 入力値 10歳 と 15歳 → 同じ結果「年齢制限エラー」（同値）
- 入力値 20歳 と 10歳 → 異なる結果（非同値）
```

### 📋 同値分割の手順（完全版）

#### 🔄 標準5ステップ

##### 🔹 Step 1: 仕様分析・条件抽出
**目的**: テスト対象の入力項目と制約条件を完全に把握する

**実行内容**:
1. 仕様書から入力項目を列挙
2. 各項目の制約条件（データ型、範囲、形式）を抽出
3. 処理分岐条件を特定
4. 暗黙の制約も考慮

**チェックリスト**:
- [ ] 全ての入力項目を列挙した
- [ ] 各項目の制約を明確にした
- [ ] IF文・CASE文等の分岐を確認した
- [ ] エラーハンドリングを把握した

##### 🔹 Step 2: 有効同値クラス特定
**目的**: 正常処理される入力範囲を明確にする

**特定基準**:
- ビジネスルールに適合する値域
- 正常な処理が実行される範囲
- ユーザーが意図する正しい入力

**記述テンプレート**:
```
EC1（有効）: [条件] → [期待される正常処理]
例: EC1（有効）: 年齢18-65歳 → 「登録完了」
```

##### 🔹 Step 3: 無効同値クラス特定
**目的**: エラー処理される入力範囲を全て洗い出す

**特定基準**:
- 制約違反の値
- 異常値・想定外入力
- データ型不一致

**無効クラスの種類**:
1. **範囲外**: 上限超過・下限未満
2. **型不一致**: 数値項目に文字列等
3. **形式不正**: メールアドレス形式違反等
4. **必須違反**: 未入力・null
5. **論理矛盾**: 開始日>終了日等

##### 🔹 Step 4: 代表値選択
**目的**: 各同値クラスから最適なテスト値を選択する

**選択基準**:
1. **典型性**: クラス内で最も一般的な値
2. **実行可能性**: 実際にテスト実行できる値
3. **明確性**: 他クラスとの区別が明確
4. **現実性**: 実際に発生しうる値

**選択ガイドライン**:
- 範囲がある場合: **中央値**を選ぶ（例: 18-65歳 → 40歳）
- 選択肢がある場合: **代表的な選択肢**を選ぶ
- 異常値: **明確に異常とわかる値**を選ぶ

##### 🔹 Step 5: テストケース作成
**目的**: 実行可能なテストケースとして文書化する

**記載項目**:
| 項目 | 内容 |
|------|------|
| **テストID** | TC001形式の一意識別子 |
| **入力値** | 選択した代表値 |
| **期待結果** | 想定される処理結果 |
| **同値クラス** | 対応する同値クラス番号 |
| **テスト手順** | 実行の具体的手順（必要に応じて） |

---

## 🛠️ 基本演習1: ECサイト会員登録（年齢入力）

### 📋 演習仕様
```
機能: 会員登録時の年齢入力チェック
制約:
  - 18歳以上65歳以下のみ登録可能
  - 整数値のみ受付
  - 未入力は拒否
  - 負の値は拒否

処理結果:
  - 18-65歳: 「登録完了」
  - 18歳未満: 「18歳未満は登録できません」
  - 65歳超過: 「65歳を超える方は登録できません」  
  - 未入力: 「年齢を入力してください」
  - 非整数: 「整数で入力してください」
  - 負の値: 「正の値を入力してください」
```

### 🔍 Step 1: 仕様分析

#### 📊 条件抽出
- **入力項目**: 年齢（整数）
- **有効範囲**: 18 ≤ 年齢 ≤ 65
- **データ型**: 整数のみ
- **必須**: 入力必須
- **処理分岐**: 
  - 18-65: 正常登録
  - <18: エラーメッセージ1
  - >65: エラーメッセージ2
  - null/空: エラーメッセージ3
  - 非整数: エラーメッセージ4
  - 負の値: エラーメッセージ5

### 🔍 Step 2-3: 同値クラス特定

#### ✅ 有効同値クラス
```
EC1（有効）: 18 ≤ 年齢 ≤ 65 の整数
→ 期待結果: 「登録完了」
```

#### ❌ 無効同値クラス
```
EC2（無効・範囲外下限）: 年齢 < 18 の整数
→ 期待結果: 「18歳未満は登録できません」

EC3（無効・範囲外上限）: 年齢 > 65 の整数  
→ 期待結果: 「65歳を超える方は登録できません」

EC4（無効・未入力）: null または 空文字
→ 期待結果: 「年齢を入力してください」

EC5（無効・型不一致）: 非整数（文字列、小数等）
→ 期待結果: 「整数で入力してください」

EC6（無効・負の値）: 年齢 < 0 の整数
→ 期待結果: 「正の値を入力してください」
```

### 🔍 Step 4: 代表値選択

| 同値クラス | 代表値 | 選択理由 |
|------------|--------|----------|
| EC1（有効） | 40 | 範囲中央値（18-65の中間） |
| EC2（無効） | 10 | 明確な下限違反 |
| EC3（無効） | 70 | 明確な上限違反 |
| EC4（無効） | "" | 空文字（未入力の代表） |
| EC5（無効） | "abc" | 文字列（型違反の代表） |
| EC6（無効） | -5 | 負の値の代表 |

### 🔍 Step 5: テストケース作成

| ID | 入力値 | 期待結果 | 同値クラス | 備考 |
|----|--------|----------|-----------|------|
| TC001 | 40 | 登録完了 | EC1 | 有効範囲の中央値 |
| TC002 | 10 | 18歳未満は登録できません | EC2 | 下限違反 |
| TC003 | 70 | 65歳を超える方は登録できません | EC3 | 上限違反 |
| TC004 | "" | 年齢を入力してください | EC4 | 未入力 |
| TC005 | "abc" | 整数で入力してください | EC5 | 型不一致 |
| TC006 | -5 | 正の値を入力してください | EC6 | 負の値 |

**テストケース数**: 6個（全条件をカバー）

---

## 🛠️ 基本演習2: 割引率計算

### 📋 演習仕様
```
機能: 購入金額に応じた割引率計算
制約:
  - 金額は0円以上
  - 整数のみ受付
  
割引率:
  - 1,000円未満: 0%割引
  - 1,000円以上10,000円未満: 5%割引
  - 10,000円以上50,000円未満: 10%割引
  - 50,000円以上: 15%割引
  
エラー:
  - 負の値: 「金額が不正です」
  - 非数値: 「数値を入力してください」
```

### 📝 自分で解いてみましょう

以下の手順で進めてください：

#### 1. 仕様分析
```
入力項目: [記入]
有効範囲: [記入]  
処理分岐: [記入]
```

#### 2. 同値クラス特定
```
有効同値クラス:
- EC1: [記入]
- EC2: [記入]
- EC3: [記入]
- EC4: [記入]

無効同値クラス:
- EC5: [記入]
- EC6: [記入]
```

#### 3. 代表値選択・テストケース作成
| ID | 入力値 | 期待結果 | 同値クラス |
|----|--------|----------|-----------|
|  |  |  |  |

### ✅ 解答例

#### 📊 同値クラス特定
**有効同値クラス**:
```
EC1（有効）: 0 ≤ 金額 < 1,000 → 0%割引
EC2（有効）: 1,000 ≤ 金額 < 10,000 → 5%割引
EC3（有効）: 10,000 ≤ 金額 < 50,000 → 10%割引
EC4（有効）: 50,000 ≤ 金額 → 15%割引
```

**無効同値クラス**:
```
EC5（無効）: 金額 < 0 → 「金額が不正です」
EC6（無効）: 非数値 → 「数値を入力してください」
```

#### 📊 代表値選択・テストケース

| ID | 入力値 | 期待結果 | 同値クラス | 選択理由 |
|----|--------|----------|-----------|----------|
| TC001 | 500 | 0%割引 | EC1 | 範囲内典型値 |
| TC002 | 5000 | 5%割引 | EC2 | 範囲内典型値 |
| TC003 | 25000 | 10%割引 | EC3 | 範囲内典型値 |
| TC004 | 100000 | 15%割引 | EC4 | 上限なし範囲 |
| TC005 | -100 | 金額が不正です | EC5 | 負数 |
| TC006 | "abc" | 数値を入力してください | EC6 | 文字列 |

**ポイント**: 4つの割引区分 + 2つの異常系 = 6テストケース

---

## 🛠️ 基本演習3: パスワード強度チェック

### 📋 演習仕様
```
機能: パスワード強度判定
制約:
  - 長さ: 8文字以上16文字以下
  - 文字種: 英数字のみ
  - 必須条件: 大文字・小文字・数字を各1文字以上含む
  
強度判定:
  - 全条件満たす: 「強」
  - 長さOK + 文字種一部不足: 「中」
  - 長さNG: 「弱」
  - 英数字以外含む: 「不正な文字が含まれています」
```

### 💡 難易度が高い問題です！

この演習は複数の条件が絡む複雑な問題です。以下のヒントを参考に挑戦してください：

#### ヒント
1. **条件を分解**: 「長さ」「文字種」「必須文字」に分けて考える
2. **優先順位**: まず長さ、次に文字種をチェック
3. **組み合わせ**: 条件の組み合わせパターンを整理

#### 考え方
```
長さ条件:
- 8文字未満 → 弱
- 8-16文字 → 次の条件へ
- 16文字超過 → 弱

文字種条件（8-16文字の場合）:
- 大文字+小文字+数字全て含む → 強
- 一部不足 → 中
- 英数字以外含む → エラー
```

### 📝 自分の解答
```
[ここに同値クラスとテストケースを記入]
```

### ✅ 解答例（簡略版）

**主要な同値クラス**:
```
EC1: 長さ < 8 → 「弱」
EC2: 長さ 8-16 + 大小数字全て → 「強」
EC3: 長さ 8-16 + 文字種不足 → 「中」
EC4: 長さ > 16 → 「弱」
EC5: 英数字以外含む → 「不正な文字が含まれています」
```

**代表的なテストケース**:
| ID | 入力値 | 期待結果 | 同値クラス |
|----|--------|----------|-----------|
| TC001 | "Pass1" | 弱 | EC1（短い） |
| TC002 | "Password123" | 強 | EC2（全条件満たす） |
| TC003 | "password123" | 中 | EC3（大文字なし） |
| TC004 | "Password123456789" | 弱 | EC4（長すぎる） |
| TC005 | "Pass@word123" | 不正な文字 | EC5（記号含む） |

**注意**: この問題は実際にはデシジョンテーブルとの組み合わせがより効果的です

---

## 🎯 同値分割の重要ポイント

### ✅ 正しい適用のチェックリスト

#### 🔍 同値クラス特定のコツ
- [ ] **仕様書の条件文を全て確認**: if文、case文の条件
- [ ] **数値範囲の境界を明確化**: 以上・以下・未満・超過の区別
- [ ] **データ型制約を考慮**: 文字列・数値・日付・真偽値
- [ ] **ビジネスルールを反映**: 業務上の特別な制約
- [ ] **エラーケースも網羅**: 異常系を見落とさない

#### 🎯 代表値選択のガイドライン
- [ ] **典型値優先**: クラス内で最も自然で一般的な値
- [ ] **実装可能性**: 実際にテスト実行できる具体値
- [ ] **明確性**: 他クラスとの区別が一目瞭然
- [ ] **再現性**: 同じ結果が必ず得られる値
- [ ] **1クラス1代表値**: 複数選ばない（重要）

### ❌ よくある間違いと対策

#### 🚫 同値クラス特定の間違い

**間違い1: 境界値を同値クラスに含める**
```
❌ 悪い例: EC1（有効）: 18歳、19歳、…、65歳
✅ 良い例: EC1（有効）: 18-65歳（代表値: 40歳）

説明: 境界値（18歳、65歳）は境界値分析で別途テスト
```

**間違い2: 過度な細分化**
```
❌ 悪い例: 
  EC1: 18-25歳
  EC2: 26-35歳
  EC3: 36-45歳
  …

✅ 良い例:
  EC1: 18-65歳（処理が同じなら1つのクラス）

説明: 処理が同じなら細かく分けない
```

**間違い3: 条件の見落とし**
```
❌ 悪い例: 有効範囲と範囲外のみ考慮
✅ 良い例: 未入力、型不一致、負の値等も考慮

説明: 仕様書に明記されていない暗黙の制約も考慮
```

#### 🚫 代表値選択の間違い

**間違い1: 境界値を代表値として選ぶ**
```
❌ 悪い例: 18-65歳の代表値 → 18歳
✅ 良い例: 18-65歳の代表値 → 40歳

説明: 境界値は境界値分析で扱う
```

**間違い2: 複数の代表値を選択**
```
❌ 悪い例: 18-65歳 → 20歳, 40歳, 60歳
✅ 良い例: 18-65歳 → 40歳

説明: 1つの同値クラスから1つの代表値
```

**間違い3: 非現実的な値**
```
❌ 悪い例: 年齢 → 999歳
✅ 良い例: 年齢 → 70歳

説明: 実際に発生しうる現実的な値を選ぶ
```

---

## 🚀 Laravel実務演習

### 📋 演習4: Formリクエストバリデーション

```php
// StoreProductRequest.php
class StoreProductRequest extends FormRequest {
    public function rules() {
        return [
            'name' => 'required|string|min:3|max:100',
            'price' => 'required|numeric|min:100|max:1000000',
            'stock' => 'required|integer|min:0|max:9999',
            'category_id' => 'required|exists:categories,id',
        ];
    }
}
```

### 📝 あなたの解答

各フィールドの同値クラスとテストケースを設計してください：

**name フィールド**
```
[同値クラスとテストケースを記入]
```

**price フィールド**
```
[同値クラスとテストケースを記入]
```

### ✅ 解答例（nameフィールドのみ）

**name フィールドの同値分割**:
```
有効同値クラス:
- EC1: 3-100文字の文字列 → バリデーション成功

無効同値クラス:
- EC2: 3文字未満 → 「nameは3文字以上必要です」
- EC3: 100文字超過 → 「nameは100文字以内必要です」
- EC4: 未入力 → 「nameは必須です」
- EC5: 数値型 → 「nameは文字列である必要があります」
```

**テストケース例**:
```php
// PHPUnit テストケース
public function test_name_valid_equivalence_class()
{
    $data = ['name' => 'テスト商品名'];  // EC1
    $response = $this->post('/products', $data);
    $response->assertSuccessful();
}

public function test_name_too_short()
{
    $data = ['name' => 'AB'];  // EC2（2文字）
    $response = $this->post('/products', $data);
    $response->assertSessionHasErrors('name');
}
```

---

## 📊 学習確認問題

### 🎯 理解度チェック

#### 📝 問題1: 概念確認（複数選択）
同値分割に関する正しい説明をすべて選んでください：

A) 同値クラス内の値は同じ処理結果を生成する  
B) 1つの同値クラスから複数の代表値を選ぶべきである  
C) 境界値は同値クラスに含めるべきである  
D) 無効同値クラスのテストも重要である  
E) テストケース削減が主な目的の1つである

#### 📝 問題2: 適用場面判定
同値分割の適用が**最も適切でない**場面は？

A) ユーザー登録フォームの年齢入力  
B) 複数条件の複雑な組み合わせ判定  
C) 商品価格による送料計算  
D) ファイルアップロードのサイズ制限

#### 📝 問題3: 実践問題
**仕様**: テスト点数評価（0-100点）
```
90点以上: A
80-89点: B  
70-79点: C
60-69点: D
60点未満: F
無効: 0未満、100超過、非数値
```

以下を答えてください：
1. 同値クラス数
2. 各クラスの代表値
3. テストケース数

### ✅ 解答

#### 🎯 問題1解答
**正解**: A, D, E

**解説**:
- A: ✅ 同値分割の基本定義
- B: ❌ 1クラス1代表値の原則（複数選ばない）
- C: ❌ 境界値は境界値分析で扱う
- D: ✅ エラーケースのテストも重要
- E: ✅ テストケース削減は主要な目的

#### 🎯 問題2解答
**正解**: B

**解説**: 複雑な条件組み合わせはデシジョンテーブルが適切。同値分割は単一条件の入力検証に向いています。

#### 🎯 問題3解答
**同値クラス数**: 7個

**同値クラスと代表値**:
```
有効同値クラス:
- EC1: 90-100点 → 代表値 95
- EC2: 80-89点 → 代表値 85  
- EC3: 70-79点 → 代表値 75
- EC4: 60-69点 → 代表値 65
- EC5: 0-59点 → 代表値 30

無効同値クラス:
- EC6: 0点未満 → 代表値 -10
- EC7: 100点超過 → 代表値 110
- EC8: 非数値 → 代表値 "abc"
```

**テストケース数**: 8個（各クラス1つずつ）

---

## 🎯 次回学習への準備

### 📚 今回で習得したスキル
- ✅ 同値分割の5ステップ手順
- ✅ 有効・無効同値クラス特定方法
- ✅ 代表値選択技術
- ✅ テストケース作成能力
- ✅ Laravel等の実務レベル演習

### 🔍 理解度自己評価

以下の項目で自己評価してください（1-5点）：

- [ ] 同値分割の手順理解: __/5点
- [ ] 同値クラス特定スキル: __/5点  
- [ ] 代表値選択スキル: __/5点
- [ ] テストケース作成スキル: __/5点
- [ ] 実務適用イメージ: __/5点

**合計点の目安**:
- 20点以上: 次のステップに進んでOK
- 15-19点: 基本演習を再度実施推奨
- 14点以下: 理論部分を復習推奨

### 🚀 次のステップ
**03_習得レベル確認.md**で学習成果を測定し、実務適用レベルへの到達度を確認します。

### 📝 学習記録テンプレート

```markdown
【同値分割学習記録 - 理論学習・基本演習】
日時: 2025/10/14
学習時間: 30分

## 習得できた内容
- 5ステップ手順の完全理解
- 基本演習3問クリア
- [その他]

## 理解困難だった点
- パスワード強度チェックの複雑な条件
- [その他]

## 実務で適用したい場面
- Laravelバリデーション設計
- API入力検証
- [その他]

## 次回学習での重点確認項目
- より複雑な実務演習
- 境界値分析との組み合わせ
- [その他]
```

---

*理論学習・基本演習完了！次は習得レベル確認へ*  
*自己評価で20点以上なら次のステップに進みましょう*
