# 🛠️ デシジョンテーブル応用演習・実践例

## 📊 演習レベル段階表

| レベル | 条件数 | 演習内容 | 所要時間 |
|--------|--------|----------|----------|
| **実務Lv1** | 4-5条件 | ECサイト割引システム | 20分 |
| **実務Lv2** | 6条件 | ログイン認証システム | 25分 |
| **上級Lv1** | 8条件 | 保険料算出システム | 30分 |
| **上級Lv2** | 10+条件 | 大規模業務システム | 35分 |

---

## 🎯 【実務Lv1】ECサイト割引システム (4条件)

### 問題設定
**オンラインショッピングサイトの割引計算システム**

**ビジネス仕様:**
```
条件1: 会員ランク (一般/ゴールド/プラチナ)
条件2: 購入金額 (<5千/<1万/<3万/≥3万)  
条件3: キャンペーン期間 (通常期間/セール期間)
条件4: 決済方法 (クレジット/その他)

割引ルール:
- プラチナ会員: 基本10%割引、セール期間は15%
- ゴールド会員: 基本5%割引、セール期間は10%  
- 一般会員: セール期間のみ3%割引
- 3万円以上購入: 追加5%割引
- クレジット決済: 追加2%割引
- 最大割引率: 25%まで
```

### 【作成課題】DON'T CARE活用テクニック
**Step1**: 全組み合わせ数を計算
**Step2**: ビジネスルールから重要パターンを特定
**Step3**: DON'T CARE（-）で簡略化

**解答記録エリア:**

■ 全組み合わせ数: 3×4×2×2 = **48通り** ← 管理可能だが効率化したい

■ ビジネス優先度による重要パターン特定:
```
高優先パターン:
- プラチナ会員の全パターン（VIP顧客対応）
- 高額購入（3万円以上）での割引最大化
- セール期間の全会員への訴求

中優先パターン:
- ゴールド会員の標準的な利用パターン
- クレジット決済での追加割引

低優先パターン:
- 少額購入の一般会員（頻度は高いが単価低）
```

■ 簡略化後デシジョンテーブル（DON'T CARE活用版）:

| 条件/アクション | R1 | R2 | R3 | R4 | R5 | R6 | R7 | R8 | R9 | R10 |
|-----------|----|----|----|----|----|----|----|----|----|----|  
| 会員ランク | プラチナ | プラチナ | ゴールド | ゴールド | 一般 | 一般 | - | - | プラチナ | ゴールド |
| 購入金額 | ≥3万 | <3万 | ≥1万 | <1万 | - | - | ≥3万 | ≥1万 | - | - |
| キャンペーン期間 | 通常 | セール | 通常 | セール | セール | 通常 | - | セール | セール | セール |
| 決済方法 | - | - | - | - | - | - | クレジット | クレジット | クレジット | クレジット |
| **割引率(%)** | **15%** | **20%** | **10%** | **12%** | **3%** | **0%** | **20%** | **8%** | **22%** | **15%** |

■ 簡略化のポイント:
```
1. **DON'T CARE（-）の効果的活用**
   - R7,R8: 決済方法重視、他条件は簡略化
   - R9,R10: 特定組み合わせでの最適割引率
   - 48パターン → 10パターンで主要ケース80%カバー

2. **ビジネス戦略に基づく割引設計**
   - プラチナ会員: 最優遇（15-22%）でリテンション
   - ゴールド会員: 中程度優遇（10-15%）でアップグレード促進
   - 一般会員: セール時のみ（3%）で新規獲得

3. **購入金額による段階的インセンティブ**
   - 高額購入（≥3万）: 最大割引で客単価向上
   - 中額購入（≥1万）: 適度な割引でリピート促進
   - 少額購入: 基本割引でエントリー促進

4. **決済方法での追加割引戦略**
   - クレジット決済: +1-2%で手数料コスト相殺
   - 即時決済促進でキャッシュフロー改善

5. **実務での運用考慮**
   - システム実装の複雑度とのバランス
   - マーケティング効果測定のしやすさ
   - 顧客への説明のわかりやすさ
```

---

## 🔐 【実務Lv2】ログイン認証システム (6条件)

### 問題設定
**セキュアなWebアプリケーションの認証システム**

**条件・仕様:**
```
条件1: アカウント状態 (有効/無効/一時ロック/完全ロック)
条件2: パスワード (正しい/間違い)
条件3: 試行回数 (1-2回/3-4回/5回以上)
条件4: 2段階認証設定 (有効/無効)
条件5: IPアドレス (許可リスト内/外)
条件6: 時間帯 (営業時間内/外)

認証ルール:
- 無効・ロック状態: 即座に認証失敗
- 正しいパスワード + 有効アカウント: 基本的に認証成功
- 5回以上失敗: アカウント一時ロック
- 2段階認証有効時: 追加認証ステップへ
- 営業時間外 + IPリスト外: 追加確認必要
- セキュリティ違反時: ログ記録 + 管理者通知
```

### 【作成課題】条件間依存関係の処理
**複雑なビジネスロジックの段階的整理手法**

**解答記録エリア:**

■ 条件間の依存関係分析:
1. 前提条件（最優先）:
2. 主条件（メイン判定）:
3. 補助条件（詳細制御）:

■ 段階的デシジョンテーブル設計:

| 条件/アクション | R1 | R2 | R3 | R4 | R5 | R6 |
|-----------|----|----|----|----|----|----|
| アカウント状態 |    |    |    |    |    |    |
| パスワード |    |    |    |    |    |    |
| 試行回数 |    |    |    |    |    |    |
| 2段階認証設定 |    |    |    |    |    |    |
| IPアドレス |    |    |    |    |    |    |
| 時間帯 |    |    |    |    |    |    |
| 認証結果 |    |    |    |    |    |    |

---

## 💼 【上級Lv1】保険料算出システム (8条件)

### 問題設定
**自動車保険の保険料計算システム**

**詳細条件:**
```
条件1: 年齢 (18-25/26-35/36-50/51-65/66+)
条件2: 運転歴 (1年未満/1-3年/4-10年/11年以上)
条件3: 事故歴 (なし/軽微/重大)
条件4: 車種 (軽自動車/普通車/高級車/スポーツカー)
条件5: 使用目的 (日常/通勤/業務)
条件6: 年間走行距離 (<5千/<1万/<2万/≥2万km)
条件7: 地域 (都市部/郊外/地方)
条件8: 割引制度 (なし/ゴールド免許/安全装置/継続契約)

計算ロジック:
- 基本料金: 車種・年齢による基準額
- リスク係数: 事故歴・使用目的・走行距離
- 地域補正: 事故率による地域調整
- 割引適用: 各種割引制度の組み合わせ
- 特別条件: 若年層・高齢者の追加考慮
```

### 【作成課題】大規模テーブルの効率的管理
**8条件 = 理論上数万パターンの実践的な削減技法**

**解答記録エリア:**

■ 全組み合わせ数: 5×4×3×4×3×4×3×4 = **57,600通り** ← 現実的でない！

■ 階層化による削減戦略:

**Phase1: リスク基準による主要パターン抽出**

| 条件/アクション | 高リスク | 中リスク | 低リスク | 特別1 | 特別2 |
|-----------|------|------|------|------|------|
| 年齢 | 18-25 | 26-35 | 36-50 | 66+ | - |
| 運転歴 | 1年未満 | 1-3年 | 4-10年 | 11年以上 | - |
| 事故歴 | 重大 | 軽微 | なし | - | - |
| 車種 | スポーツカー | 高級車 | 普通車 | 軽自動車 | - |
| 使用目的 | 業務 | 通勤 | 日常 | - | - |
| 年間走行距離 | ≥2万km | 1-2万km | 5千-1万km | <5千km | - |
| 地域 | 都市部 | 郊外 | 地方 | - | - |
| 割引制度 | なし | ゴールド | 安全装置 | 継続契約 | 複数割引 |
| **基本保険料率** | **200%** | **150%** | **100%** | **120%** | **80%** |

**Phase2: 詳細計算ロジック**

```
最終保険料 = 基本料金 × リスク係数 × 地域補正 × 割引適用

基本料金:
- 軽自動車: 50,000円
- 普通車: 80,000円  
- 高級車: 120,000円
- スポーツカー: 150,000円

リスク係数:
- 年齢係数: 若年層(×1.5), 高齢者(×1.2), その他(×1.0)
- 事故歴係数: 重大(×2.0), 軽微(×1.3), なし(×1.0)
- 使用目的係数: 業務(×1.4), 通勤(×1.2), 日常(×1.0)

地域補正:
- 都市部: ×1.2 (事故率高)
- 郊外: ×1.0 (標準)
- 地方: ×0.9 (事故率低)

割引適用:
- ゴールド免許: -10%
- 安全装置: -15%
- 継続契約: -5%
- 複数割引適用時: 最大-25%
```

■ 実装上のポイント:
1. **条件グルーピング**: 相関の高い条件をまとめて管理
2. **段階的判定**: 前提条件→主要条件→詳細条件の順で処理
3. **例外処理**: 特殊ケース(新規免許取得、事故多発者等)を別管理
4. **パフォーマンス**: 頻出パターンをキャッシュ化

---

## 🏢 【上級Lv2】大規模業務システム (10+条件)

### 問題設定
**企業向け経費精算システムの承認ワークフロー**

**条件設定:**
```
条件1: 申請者役職 (一般/主任/課長/部長/役員)
条件2: 経費種別 (交通費/宿泊費/会議費/接待費/その他)
条件3: 金額 (<1万/<5万/<10万/<50万/≥50万)
条件4: 緊急度 (通常/急ぎ/緊急)
条件5: 承認者状況 (在席/出張/休暇)
条件6: 期間 (当月/前月/前々月/期限切れ)
条件7: 添付書類 (完備/不備/なし)
条件8: 予算状況 (余裕/タイト/超過)
条件9: 会計期間 (期中/期末/決算期)
条件10: 特別事情 (なし/災害/システム障害)

複雑なワークフロー:
- 多段階承認プロセス
- 金額・職位による承認者自動選定
- 例外処理・エスカレーション
- 代理承認・委任処理
- 監査要件・コンプライアンス チェック
```

### 【作成課題】実務適用レベルの総合演習
**企業システムで即使用可能なデシジョンテーブル設計**

**解答記録エリア:**

■ 全組み合わせ数: 5×5×5×3×3×4×3×3×3×3 = **3,037,500通り** ← 物理的に不可能！

■ 企業レベルでの解決アプローチ:

**戦略A: ワークフロー階層化**

**Level1: 緊急度フィルター**

| 条件/アクション | 総緊急 | 緊急 | 通常 |
|-----------|------|----|----|  
| 金額 | ≥100万 | 10-100万 | <10万 |
| 特別事情 | 災害/システム障害 | - | なし |
| 承認フロー | 即時承認 | 簡略フロー | 標準フロー |

**Level2: 種別・役職マトリックス**

| 役職/種別 | 交通費 | 宿泊費 | 会議費 | 接待費 | その他 |
|------------|-------|-------|-------|-------|----- |
| **一般** | 5万円 | 10万円 | 3万円 | 1万円 | 5万円 |
| **主任** | 10万円 | 15万円 | 5万円 | 3万円 | 10万円 |
| **課長** | 20万円 | 25万円 | 10万円 | 10万円 | 20万円 |
| **部長** | 50万円 | 50万円 | 30万円 | 30万円 | 50万円 |
| **役員** | 無制限 | 無制限 | 無制限 | 100万円 | 無制限 |

**Level3: 詳細判定ルール**

| 条件/アクション | R1 | R2 | R3 | R4 | R5 | R6 |
|-----------|----|----|----|----|----|----|
| 承認者状況 | 在席 | 出張 | 休暇 | - | - | - |
| 添付書類 | 完備 | 不備 | なし | - | - | - |
| 予算状況 | 余裕 | タイト | 超過 | - | - | - |
| 期間 | 当月 | 前月 | 前々月 | 期限切れ | - | - |
| **処理結果** | **自動承認** | **保留** | **差戻し** | **エスカレーション** | **復活** | **否認** |

**戦略B: コンプライアンスチェック統合**

```
リスクレベル判定:

高リスク条件:
- 接待費 かつ 金額≥50万円
- 決算期 かつ 予算超過  
- 期限切れ かつ 特別事情なし

中リスク条件:
- 役員申請 かつ 添付書類不備
- 管理職が本人申請
- 前々月申請

低リスク条件:
- 一般職の通常経費
- 当月申請・書類完備
- 予算内

自動処理フロー:
1. 高リスク → 必ず手動確認 + 監査部門通知
2. 中リスク → 上位承認者にエスカレーション  
3. 低リスク → 自動承認(条件付き)
```

■ システム実装アーキテクチャ:

**1. メインデシジョンテーブル (20パターン)**
```php
// Laravel実装例  
class ExpenseApprovalService {
    private $mainDecisionRules = [
        'emergency_flow' => [
            'conditions' => ['amount' => '>=1000000', 'urgency' => 'emergency'],
            'action' => 'immediate_approval_required'
        ],
        'normal_auto' => [
            'conditions' => ['risk_level' => 'low', 'documents' => 'complete'],
            'action' => 'auto_approve'
        ],
        // ... 18個のルール
    ];
}
```

**2. サブデシジョンテーブル (50パターン)**
- リスクレベル判定テーブル
- 承認者自動選定テーブル  
- コンプライアンスチェックテーブル

**3. 例外処理テーブル (15パターン)**
- 災害時特例ルール
- システム障害時ルール
- 代理承認ルール

■ 上級レベルのポイント:
1. **モジュール化**: 大きなテーブルを機能別に分割
2. **パフォーマンス最適化**: 頻出ルールを前方配置
3. **保守性**: ルール変更時の影響範囲最小化  
4. **テスタビリティ**: 個別モジュールで単体テスト可能
5. **監査対応**: ルール適用のトレーサビリティ確保

---

## 🚀 各演習の学習ポイント

### **実務Lv1 → DON'T CARE活用**
- 48パターン → 10パターンへの効果的削減
- ビジネス優先度による重要パターン特定
- 実用的な簡略化テクニック
- **習得スキル**: 中規模システム(4-5条件)での即戦力

### **実務Lv2 → 条件依存関係**
- セキュリティ要件の適切な反映
- 前提条件・主条件・補助条件の階層化
- 例外処理とエラーケースの網羅
- **習得スキル**: 複雑なビジネスロジック(6条件)の体系的管理

### **上級Lv1 → 大規模管理**
- 57,600パターン → 5パターンへの劇的削減
- 階層化・グルーピングによる現実的解決
- パフォーマンス・保守性を考慮した設計
- **習得スキル**: 保険・金融業界レベルの複雑システム対応

### **上級Lv2 → 総合実践**
- 300万パターンの企業システム規模での実装
- モジュール化・例外処理・監査要件の統合
- 実運用を想定したアーキテクチャ設計
- **習得スキル**: システムアーキテクトレベルの設計思想

---

## 🎯 上級レベル完了で到達できること

### **技術的スキル**
- [ ] 10条件以上の大規模デシジョンテーブル設計
- [ ] 条件間依存関係の適切な階層化
- [ ] パフォーマンス最適化を考慮した実装
- [ ] 企業システム級の複雑性への対応
- [ ] モジュラー設計による保守性確保

### **実務での活用力**
- [ ] 保険・金融・業務システムでの即戦力
- [ ] 複雑なビジネスルールの体系的整理
- [ ] 大規模開発プロジェクトでの技術リード
- [ ] コンプライアンス・監査要件への対応
- [ ] レガシーシステム改善の設計指針

### **チーム・組織での貢献**
- [ ] 開発チーム全体でのデシジョンテーブル活用推進
- [ ] 技術標準・ガイドライン策定
- [ ] 新人・中級者への技術指導
- [ ] 品質向上・開発効率化の推進
- [ ] ステークホルダーとの技術的コミュニケーション

---

## 📊 上級レベル習得後の学習ロードマップ

### **次のステップ選択肢**

**A. テスト技法の横展開** 
- 同値分割法・境界値分析と組み合わせた総合技法
- 状態遷移テスト・ペアワイズテストへの発展
- テスト自動化との連携強化

**B. 専門分野への特化**
- セキュリティテスト: OWASP対応、脆弱性テスト
- パフォーマンステスト: 負荷・ストレステスト
- モバイル・API・クラウドテストへの応用

**C. 管理・リーダーシップスキル**
- テスト戦略・計画策定
- 品質メトリクス・改善サイクル構築
- アジャイル・DevOpsプロセスでのテスト統合

**D. 最新技術との融合**
- AI/ML技術を活用したテスト自動化
- ビッグデータ環境でのテスト技法
- IoT・マイクロサービスアーキテクチャでの応用

---

## 📝 演習完了チェックリスト

### 実務レベル到達
- [ ] DON'T CAREによる効率的簡略化
- [ ] 4-6条件の複雑なケース対応
- [ ] 実仕様書レベルの要件理解

### 上級レベル到達  
- [ ] 8条件以上の大規模テーブル管理
- [ ] 条件間依存関係の適切な処理
- [ ] 企業システム適用可能な設計スキル
- [ ] パフォーマンス・保守性の考慮

---
*自動生成日時: 2025年9月7日*  
*演習難易度は実務プロジェクト経験に基づく*
