# 💡 デシジョンテーブル実務適用ガイド

## 🎯 実務での活用パターン

### **適用判断フローチャート**
```
複数条件の判定が必要？
    ↓ YES
条件数は何個？
├─ 2-3個 → 同値分割・境界値で十分
├─ 4-7個 → デシジョンテーブルが最適 ★
└─ 8個以上 → デシジョンテーブル + 階層化設計

ビジネスルールが複雑？
    ↓ YES  
IF-THEN-ELSEが多段？
    ↓ YES
デシジョンテーブル適用 ★
```

---

## 🔗 他テスト技法との組み合わせパターン

### **パターン1: 同値分割 + デシジョンテーブル**
```
適用例: ユーザー登録システム

Step1: 同値分割で各条件を分類
├─ 年齢: 有効値(18-99)/無効値(<18, >99)/境界値(18,99)
├─ メール: 有効形式/無効形式
└─ パスワード: 条件満たす/満たさない

Step2: デシジョンテーブルで組み合わせ管理

| 条件/アクション | R1 | R2 | R3 | R4 |
|-------------|----|----|----|----|  
| 年齢        | 有効 | 無効 | 有効 | 有効 |
| メール形式  | 有効 | - | 無効 | 有効 |
| パスワード  | 満たす | - | - | 満たさない |
| **登録結果** | **成功** | **失敗** | **失敗** | **失敗** |
```

### **パターン2: 境界値分析 + デシジョンテーブル**
```
適用例: 料金計算システム

境界値による詳細テストケース:
├─ 金額境界: 9,999円/10,000円/10,001円
├─ 年齢境界: 19歳/20歳/21歳  
└─ 回数境界: 4回/5回/6回

デシジョンテーブルで境界値パターンを系統的に管理:
各境界値を条件として組み込み、網羅的なテストケース生成
```

### **パターン3: 状態遷移 + デシジョンテーブル**
```
適用例: ワークフローシステム

各状態での判定条件をデシジョンテーブルで管理:
├─ 申請中状態: 承認/却下条件のテーブル
├─ 承認待ち状態: エスカレーション条件のテーブル
└─ 完了状態: 再申請可否条件のテーブル
```

---

## 📋 実仕様書からの要件抽出手法

### **Step1: 仕様書の構造化分析**
```
仕様書例文:
「プレミアム会員の場合、平日午前中（9-12時）の注文で、
 購入金額が1万円以上なら送料無料とし、さらに5%割引を適用する。
 ただし、セール期間中は割引率を3%に変更する。
 また、クレジットカード決済の場合は追加で1%割引する。」

↓ 分析プロセス

1. 条件の抽出:
   - 会員種別: 一般/プレミアム
   - 注文時間: 平日午前(9-12)/平日午後/休日  
   - 購入金額: <1万円/≥1万円
   - 期間: 通常期間/セール期間
   - 決済方法: クレジット/その他

2. アクションの抽出:
   - 送料: 有料/無料
   - 割引率: 0%/1%/3%/5%/6%

3. ビジネスルールの整理:
   - 基本条件: プレミアム + 平日午前 + ≥1万円
   - 例外処理: セール期間の割引率変更
   - 追加条件: クレジット決済の追加割引
```

### **Step2: 暗黙の条件の発見**
```
明示されていない条件の推定:
├─ システム利用時間帯（メンテナンス時間など）
├─ 在庫状況（在庫切れ時の処理）
├─ 会員状態（有効/無効/停止中）
└─ 地域制限（配送不可地域など）

→ ステークホルダーとの確認が必要な条件をリストアップ
```

### **Step3: 仕様の矛盾・曖昧性の特定**
```
よくある問題パターン:
├─ 条件の優先順位が不明
├─ 例外処理の網羅性不足  
├─ 境界値の扱いが曖昧
└─ 複数条件の組み合わせ効果が不明

→ デシジョンテーブル作成により早期発見可能
```

---

## 🧪 テストケース生成パターン

### **パターンA: 全組み合わせベース**
```
小規模システム（3-4条件）での基本アプローチ:

1. 全パターン生成
2. ビジネス的に無意味なパターンを除外
3. 重要度による優先順位付け
4. テストケース ID との対応付け

例: デシジョンテーブル R1 → TC001-005
```

### **パターンB: リスクベース選択**
```
大規模システムでの効率的アプローチ:

1. 高リスクパターンの特定
   ├─ 金額が大きい処理
   ├─ セキュリティに関わる判定
   └─ 法的要件に関連する処理

2. 境界値・例外ケースの優先
3. 過去の不具合パターンの重点化
4. ビジネス影響度による重み付け
```

### **パターンC: 段階的網羅**
```
複雑システムでの段階的実装:

Phase1: 主要パターン（正常系）
├─ R1-R5: 最も頻繁に使用される組み合わせ
└─ 基本機能の動作確認

Phase2: 例外パターン（異常系）  
├─ R6-R10: エラー処理・例外処理
└─ システムの堅牢性確認

Phase3: 境界・特殊パターン
├─ R11-R15: 境界値・特殊条件
└─ 完全性・網羅性確認
```

---

## 🛠️ 実装・運用のベストプラクティス

### **設計時の注意点**
```
1. 条件の独立性確保
   - 条件間の相関を最小化
   - 依存関係がある場合は明示的に管理

2. 保守性の考慮
   - 条件追加時の影響範囲最小化
   - テーブルの論理構造を明確化

3. 可読性の向上
   - 条件・アクションの命名統一
   - コメント・説明の併記
```

### **テストツールとの連携**
```
Excel活用パターン:
├─ 条件組み合わせの自動生成
├─ テストケース管理との連携
└─ 実行結果の集計・分析

専用ツール活用:
├─ PICT（ペアワイズ組み合わせ）
├─ Decision Table Processor
└─ テスト管理ツールのインポート機能
```

### **Laravel プロジェクトでの実装例**
```php
// Serviceクラスでのデシジョンテーブル実装例
class DiscountCalculationService 
{
    private $discountRules = [
        ['member' => 'premium', 'amount' => '>=10000', 'period' => 'sale', 'discount' => 0.08],
        ['member' => 'premium', 'amount' => '>=10000', 'period' => 'normal', 'discount' => 0.05],
        ['member' => 'premium', 'amount' => '<10000', 'period' => '*', 'discount' => 0.03],
        // ...デシジョンテーブルのルールを配列で管理
    ];
    
    public function calculateDiscount($memberType, $amount, $period): float
    {
        foreach ($this->discountRules as $rule) {
            if ($this->matchesRule($rule, $memberType, $amount, $period)) {
                return $rule['discount'];
            }
        }
        return 0.0;
    }
}

// テストクラスでの活用
class DiscountCalculationTest extends TestCase 
{
    /**
     * @dataProvider discountDecisionTableProvider
     */
    public function testDiscountCalculation($member, $amount, $period, $expected)
    {
        $service = new DiscountCalculationService();
        $result = $service->calculateDiscount($member, $amount, $period);
        $this->assertEquals($expected, $result);
    }
    
    public function discountDecisionTableProvider(): array
    {
        // デシジョンテーブルの各行をテストケースとして返す
        return [
            ['premium', 15000, 'sale', 0.08],    // R1
            ['premium', 15000, 'normal', 0.05],  // R2  
            ['premium', 5000, 'sale', 0.03],     // R3
            // ...
        ];
    }
}
```

---

## 📊 効果測定・改善サイクル

### **効果指標**
```
テスト設計効率:
├─ テーブル作成時間 vs 手作業時間
├─ 条件追加時の影響範囲特定時間
└─ テストケース生成・更新時間

テスト品質:  
├─ 条件組み合わせの網羅率
├─ 発見された欠陥の種類・重要度
└─ 本番環境での不具合発生率

保守性:
├─ 仕様変更時のテーブル更新容易性
├─ 新規メンバーの理解習得時間  
└─ ドキュメントとしての活用頻度
```

### **継続改善**
```
定期的な見直しポイント:
├─ 不要になった条件の削除
├─ 新たに必要な条件の追加
├─ テーブル構造の最適化
└─ ツール・プロセスの改善
```

---

## 🎯 習得レベル別活用指針

### **実務レベル（即戦力）**
- 4-6条件の標準的なビジネスロジック対応
- DON'T CARE活用による効率化
- 他技法との基本的な組み合わせ

### **上級レベル（技術リーダー）**  
- 8条件以上の大規模システム設計
- 複雑な依存関係・制約の適切な管理
- 開発チーム全体でのデシジョンテーブル活用推進

### **エキスパートレベル（アーキテクト）**
- 企業レベルでの標準化・ガイドライン策定
- ツールチェーンとの統合設計
- ROI測定・効果最大化の仕組み構築

---
*自動生成日時: 2025年9月7日*  
*実務経験12年のテストエンジニアの知見を集約*
