# 🧠 エラー推測 理論学習・基本演習

## 📚 エラー推測の基本理論

### 🎯 エラー推測の基本プロセス

#### 🔄 4段階のエラー推測サイクル
```
【Step 1】経験・知見の活用
↓ 過去の失敗事例、技術知識、ドメイン知識から推測
【Step 2】仮説の形成  
↓ 「ここでエラーが起きそう」という具体的な仮説設定
【Step 3】集中的なテスト実施
↓ 推測箇所への重点的なテスト投入
【Step 4】結果の分析・学習
↓ 的中・外れの分析と新たな知見の蓄積
```

#### 💡 効果的な推測のための思考法
```
【Why思考】なぜここでエラーが起きそうか？
- 実装の複雑さ
- 過去の類似事例
- 技術的制約
- ユーザー操作パターン

【What思考】どんなエラーが起きそうか？
- 機能的な問題
- 性能・応答性の問題
- セキュリティの問題
- ユーザビリティの問題

【How思考】どうやって再現させるか？
- 特定の操作手順
- 特定のデータ条件
- 特定の環境条件
- 特定のタイミング
```

---

## 📋 代表的なエラーパターン集

### 🌐 入力・データ処理系エラーパターン

#### 🔸 基本的な入力エラーパターン
```
【特殊文字・エンコーディング】
❌ シングルクォート（'）でSQL文エラー
❌ ダブルクォート（"）でJSONパースエラー  
❌ バックスラッシュ（\）でエスケープエラー
❌ 絵文字・特殊記号で文字化け
❌ マルチバイト文字で文字数計算エラー

【境界値・例外値】
❌ 空文字列でNullPointerException
❌ 最大値+1でオーバーフロー
❌ 負の数で配列インデックスエラー
❌ 小数点以下の桁数超過
❌ 日付の存在しない日（2/30等）

【フォーマット・形式】
❌ メールアドレス形式の緩い検証
❌ 電話番号の国際フォーマット未対応
❌ 郵便番号の桁数・形式エラー
❌ クレジットカード番号の検証不備
❌ パスワード強度チェックの抜け道
```

#### 🎯 基本演習1: 入力フィールドエラー推測
**対象**: ユーザー登録フォーム
```
【演習手順】
1. 下記の登録フォームを想定
   - 名前（必須、50文字以内）
   - メールアドレス（必須、一意）
   - パスワード（必須、8文字以上）
   - 電話番号（任意）

2. 各フィールドで考えられるエラーを5個ずつ推測

3. 推測根拠を明記して記録

【解答例】
名前フィールド:
- 空白文字のみの入力 → 必須チェック抜け
- 50文字ちょうどの名前 → 境界値問題
- タブ文字・改行文字 → 表示崩れ
- SQLインジェクション文字 → セキュリティ
- 絵文字入りの名前 → エンコーディング
```

---

### 🔄 状態・遷移系エラーパターン

#### 🔸 セッション・認証関連
```
【セッション管理】
❌ セッションタイムアウト後の操作継続
❌ 複数タブでの同時ログイン
❌ ブラウザ戻るボタンでの状態不整合
❌ セッションハイジャック攻撃
❌ 長時間セッション保持での問題

【権限・認可】  
❌ 権限昇格による不正アクセス
❌ 他ユーザーのデータへの直接アクセス
❌ 管理者機能への一般ユーザーアクセス
❌ 削除済みユーザーでのアクセス継続
❌ 権限変更の即座反映未対応
```

#### 🔸 データ状態・整合性
```
【排他制御・競合状態】
❌ 複数ユーザーによる同時更新
❌ 在庫数の競合状態での売り越し
❌ カウンターの競合状態での重複
❌ ファイルアップロードの競合
❌ 決済処理の二重実行

【データ整合性】
❌ 親レコード削除時の子レコード残存
❌ トランザクション途中での異常終了
❌ マスタデータ更新時の不整合
❌ キャッシュとDBの不整合
❌ バックアップデータの整合性
```

#### 🎯 基本演習2: 状態遷移エラー推測
**対象**: Eコマースの商品注文システム
```
【システム状態】
商品選択 → カート追加 → 注文確認 → 決済 → 完了

【演習課題】
各状態遷移で考えられるエラーを推測し、
具体的な再現手順と期待される問題を記述

【推測観点】
- ブラウザ操作（戻る、リロード、タブ操作）
- ネットワーク異常（切断、遅延）
- データ変更（在庫、価格、ユーザー権限）
- 時間経過（セッションタイムアウト、期限切れ）

【解答例の一部】
カート → 注文確認遷移:
推測: カート画面で長時間放置後に進む
根拠: セッションタイムアウトや商品情報変更の可能性
期待問題: 価格変更未反映、商品売り切れ未検知
再現手順: カート画面で30分放置→注文確認ボタン押下
```

---

### 🌐 統合・連携系エラーパターン

#### 🔸 外部システム連携
```
【API・Webサービス連携】
❌ 外部API呼び出しタイムアウト
❌ APIレスポンス形式の予期しない変更
❌ 認証トークンの期限切れ
❌ API利用制限（レート制限）の超過
❌ 外部システムのメンテナンス時間での呼び出し

【データベース・ファイル連携】
❌ データベース接続プール枯渇
❌ ファイルロック状態での読み書き
❌ ディスク容量不足でのファイル書き込み
❌ ネットワークドライブの切断
❌ 文字エンコーディングの不一致
```

#### 🔸 ブラウザ・環境依存
```
【ブラウザ差異】
❌ JavaScript実行の ブラウザ差異
❌ CSS表示のブラウザ差異
❌ ファイルアップロード機能の差異
❌ セキュリティポリシーの差異
❌ Cookie・ローカルストレージの制限差異

【デバイス・OS差異】
❌ モバイル画面での表示崩れ
❌ タッチ操作での誤動作
❌ 画面向き変更での表示問題
❌ OS固有機能の未対応
❌ ハードウェア制約での動作不良
```

---

### 📊 パフォーマンス・スケーラビリティ系

#### 🔸 性能劣化パターン
```
【データ量増加】
❌ レコード数増加での検索速度低下
❌ ファイルサイズ増大での処理時間増
❌ 画像・動画での表示遅延
❌ ログファイル肥大化での容量圧迫
❌ メモリリークによる段階的性能低下

【同時アクセス】
❌ 想定以上のユーザー数でのレスポンス低下
❌ バッチ処理実行中のレスポンス影響
❌ データベースロック競合
❌ セッション管理での競合
❌ キューイング処理でのボトルネック
```

---

## 🛠️ エラー推測の実践技法

### 🎯 推測の体系化アプローチ

#### 📊 STRIDE法によるエラー推測
```
【S】Spoofing（なりすまし）
- 他ユーザーへのなりすまし
- 偽のメール送信者
- 偽のシステムメッセージ

【T】Tampering（改ざん）  
- データベースの直接操作
- 通信データの改ざん
- ログファイルの改ざん

【R】Repudiation（否認）
- 操作ログの未記録
- 削除操作の追跡不可
- 決済処理の証跡不備

【I】Information Disclosure（情報漏洩）
- エラーメッセージでの内部情報露出
- 権限外データの閲覧
- ログファイルでの機密情報露出

【D】Denial of Service（サービス拒否）
- 大量リクエストでのサーバーダウン
- 無限ループによるリソース枯渇
- ファイル容量制限の悪用

【E】Elevation of Privilege（権限昇格）
- 管理者権限への昇格
- 他ユーザー権限での操作
- システム権限での実行
```

#### 🔍 OWASP Top 10ベースの推測
```
【A01: アクセス制御の不備】
- 縦方向アクセス制御の回避
- 横方向アクセス制御の回避
- 権限設定の設定ミス

【A02: 暗号化の失敗】
- 平文でのデータ送信
- 弱い暗号化アルゴリズム
- 暗号鍵の不適切な管理

【A03: インジェクション】
- SQLインジェクション
- XSS（クロスサイトスクリプティング）
- コマンドインジェクション
```

### 🎯 基本演習3: 体系的エラー推測
**対象**: オンライン銀行システムのログイン機能

#### 📋 演習手順
```
1. STRIDE法で各観点からエラーを推測
2. OWASP Top 10の観点で推測
3. 過去の金融系システム障害事例から推測
4. 推測結果を重要度順に並べ替え
5. 上位5つについて具体的なテスト手順を作成
```

#### 📊 演習テンプレート
```
【推測観点】: Spoofing（なりすまし）
【推測内容】: 他人のIDでのログイン試行
【根拠】: パスワードリセット機能の脆弱性
【影響度】: 高（個人資産への不正アクセス）
【再現手順】:
1. パスワードリセット画面でターゲットのIDを入力
2. 一時的なリセットコードの推測・総当たり
3. 弱いリセットコードでの認証突破
【期待される問題】: 他人口座への不正ログイン成功
```

---

## 📈 エラー推測の精度向上テクニック

### 🎯 推測根拠の構造化

#### 💡 3層推測モデル
```
【Layer 1】直接経験ベース
- 自分が過去に遭遇したエラー
- 自分が作成したシステムの弱点
- 自分が解決した問題パターン

【Layer 2】間接経験ベース  
- 同僚・チームメンバーからの情報
- 社内他プロジェクトの事例
- 社外セミナー・勉強会での知見

【Layer 3】一般知識ベース
- 技術文書・書籍での一般的パターン
- インターネットでの事例・記事
- 業界標準・ベストプラクティス
```

#### 🔍 推測精度の評価基準
```
【的中率】= 実際に問題が見つかった推測 / 全推測数
目標: 30%以上（優秀レベル: 50%以上）

【重要問題発見率】= 重要問題の発見数 / 全重要問題数  
目標: 70%以上（優秀レベル: 90%以上）

【効率性】= 発見問題の重要度 / 投入時間
継続的改善の指標として活用
```

### 🎯 基本演習4: 推測精度向上練習

#### 📊 演習：ECサイト検索機能
```
【システム仕様】
- 商品名、カテゴリ、価格帯での検索機能
- 検索結果の並び替え（価格、人気度、新着）
- 検索履歴の保存機能
- 検索結果のページング（20件/ページ）

【課題】
1. 30個のエラー推測を行う
2. 各推測に3層モデルでの根拠を記載
3. 重要度（高/中/低）を設定
4. 実際にテストを実施して的中・外れを記録
5. 結果分析とパターン改善案を作成

【評価観点】
- 推測の多様性（機能、性能、セキュリティ等）
- 根拠の妥当性と具体性
- 重要度設定の適切性
- 実施可能性の高さ
```

---

## 📝 推測結果の記録・活用方法

### 🗂️ エラー推測記録フォーマット

#### 📋 標準記録テンプレート
```
【推測ID】: EG001
【日時】: 2025/09/08 14:30
【対象システム】: ユーザー管理システム
【機能】: パスワード変更機能

【推測内容】: 現在のパスワード確認なしでの変更可能
【推測根拠】:
- Layer 1: 過去のシステムで同様の実装不備経験
- Layer 2: 他チームでの類似障害事例
- Layer 3: OWASP認証ガイドラインでの指摘事項

【重要度】: 高
【影響範囲】: 全ユーザーアカウント
【実施方法】: パスワード変更画面で現在パスワード欄を空白で送信

【結果】: ✅的中 - 現在パスワードなしで変更成功
【発見問題】: 認証なしパスワード変更の脆弱性
【学んだこと】: パスワード変更時の認証確認は基本実装でも漏れやすい
```

### 🔄 知見の蓄積・共有プロセス

#### 📚 個人ナレッジベースの構築
```
【エラーパターン辞書】
- カテゴリ別（機能、性能、セキュリティ等）
- システム種別（Web、モバイル、バッチ等）
- 技術別（Java、JavaScript、DB等）
- 発見頻度・重要度での分類

【推測的中・外れ分析】
- 的中パターンの特徴分析
- 外れパターンの要因分析
- 推測精度の時系列変化
- 改善につながった要因
```

#### 👥 チーム知見共有の仕組み
```
【定期共有会】（週1回・30分）
- 今週の推測結果共有
- 新発見パターンの紹介
- 推測技法の相互学習
- 次週の推測計画討議

【エラーパターン Wiki】
- チーム共通のエラーパターン集
- プロジェクト固有のパターン
- 外部情報の共有・整理
- 新人教育用資料としても活用
```

---

## 🎯 実践課題：総合エラー推測演習

### 📋 課題設定：業務システム統合テスト

#### 🏢 対象システム概要
```
【システム名】: 人事給与システム
【主要機能】:
- 従業員マスタ管理（登録、更新、削除）
- 勤怠管理（出退勤記録、有給申請）
- 給与計算（基本給、手当、控除）
- 年末調整（源泉徴収票、控除申告）

【技術構成】:
- フロントエンド: React + TypeScript
- バックエンド: Java Spring Boot
- データベース: PostgreSQL
- 外部連携: 税務システム、銀行振込API
```

#### 🎯 総合演習課題
```
【Phase 1】システム分析（30分）
1. システム全体のアーキテクチャ理解
2. 主要データフローの把握
3. 外部システム連携ポイントの特定
4. ビジネスクリティカルな機能の特定

【Phase 2】エラー推測実施（90分）  
1. 機能別エラー推測（各機能10個以上）
2. 統合・連携観点でのエラー推測
3. 非機能要件（性能、セキュリティ）でのエラー推測
4. 推測結果の重要度・優先度付け

【Phase 3】テスト計画立案（60分）
1. 推測結果に基づくテスト計画作成
2. テスト実施順序と時間配分
3. 期待される問題とその対策
4. 他のテスト技法との組み合わせ計画

【Phase 4】振り返り・改善（30分）
1. 推測プロセスの振り返り
2. 推測精度向上の改善案
3. 次回に活かす学習ポイント
4. チーム共有すべき知見の整理
```

### 📊 演習評価基準
```
【推測の質】(40%)
- 推測の具体性と実現可能性
- 根拠の明確性と妥当性
- 重要度設定の適切性
- 多様な観点の網羅性

【実践性】(30%)
- 実際の テスト実施可能性
- ビジネス価値への貢献度
- 他技法との組み合わせ考慮
- 効率的な実施計画

【学習・改善】(30%)
- 推測プロセスの振り返り深度
- 具体的な改善案の実現可能性
- 知見の構造化・体系化
- チーム貢献への視点
```

---

## 🔗 次のステップ

基本的なエラー推測の理論と実践演習が完了しました。次は **03_習得レベル確認.md** で理解度をチェックし、弱点を特定してください。

### 📚 復習ポイント
- エラー推測の4段階サイクル
- 代表的なエラーパターンの分類と具体例
- 推測根拠の3層モデル
- 記録・共有・改善のプロセス

### 🎯 継続学習の指針
- 日常業務でのエラー推測の実践
- 推測結果の継続的な記録・分析
- チームメンバーとの知見共有
- 新しいエラーパターンの発見・蓄積

---

## 🔗 関連ファイル
- **前のステップ**: `01_学習準備・概要把握.md`
- **次のステップ**: `03_習得レベル確認.md`
- **参考**: `../01_exploratory_testing/02_理論学習・基本演習.md`
- **応用**: `04_上級演習・実務レベル.md`

🧠 **エラー推測は経験と知識を価値に変換する技法です。継続的な実践と改善で推測精度を高めていきましょう！**
