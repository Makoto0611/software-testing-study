# ✅ 分岐網羅（Branch Coverage）- 習得レベル確認

## 🎯 この確認テストの目的
- 分岐網羅の理論理解を確認する
- 実践的なスキル習得レベルを評価する
- 次の学習段階への準備状況を判定する

---

## 📊 理論理解確認（配点：40点）

### 📝 問題1（10点）
以下の説明で正しいものを**すべて**選んでください。

**選択肢**：
A. 分岐網羅は命令網羅よりも厳しい基準である
B. 分岐網羅100%なら命令網羅も100%になる
C. 命令網羅100%なら分岐網羅も100%になる
D. 分岐網羅では各条件でTrue/False両方をテストする
E. while文やfor文にも分岐が存在する

**解答**: A, B, D, E
**解説**: Cは間違い。命令網羅100%でも分岐網羅は不十分な場合がある。

---

### 📝 問題2（15点）
以下のコードの**総分岐数**を答えてください。

```java
public String processOrder(int amount, boolean isPremium, String coupon) {
    if (amount <= 0) {                    // 分岐?
        return "Invalid amount";
    }
    
    double discount = 0.0;
    if (isPremium) {                      // 分岐?
        discount = 0.10;
    }
    
    if (coupon != null && coupon.equals("SAVE10")) {  // 分岐?
        discount += 0.10;
    }
    
    for (int i = 0; i < 3; i++) {         // 分岐?
        if (amount > 1000 * (i + 1)) {    // 分岐?
            discount += 0.05;
        }
    }
    
    return "Processed with " + discount + " discount";
}
```

**解答**: 総分岐数 = **10分岐**
**解説**: 
- `amount <= 0`: 2分岐（T/F）
- `isPremium`: 2分岐（T/F）
- `coupon != null && coupon.equals("SAVE10")`: 2分岐（T/F）
- `for (int i = 0; i < 3; i++)`: 2分岐（ループ実行/非実行）
- `amount > 1000 * (i + 1)`: 2分岐（T/F）

---

### 📝 問題3（15点）
分岐網羅率の計算をしてください。

```java
public boolean validateEmail(String email) {
    if (email == null) {              // 分岐1
        return false;
    }
    
    if (email.contains("@")) {        // 分岐2
        if (email.endsWith(".com")) { // 分岐3
            return true;
        }
    }
    
    return false;
}
```

**テストケース**：
1. `validateEmail("test@example.com")` → true
2. `validateEmail("invalid")` → false

**解答**: 分岐網羅率 = **50%**
**解説**:
- 総分岐数: 6分岐（分岐1～3のT/F）
- 実行分岐: 3分岐（分岐1-F, 分岐2-T, 分岐3-T）
- 3/6 × 100% = 50%

---

## 🛠️ 実践スキル確認（配点：60点）

### 💪 問題4（20点）
以下のメソッドで**100%分岐網羅**を達成する最小限のテストケースを設計してください。

```java
public class ScoreCalculator {
    public String calculateGrade(int score, boolean hasBonus) {
        if (score < 0 || score > 100) {
            return "Invalid score";
        }
        
        if (hasBonus) {
            score += 5;
        }
        
        if (score >= 90) {
            return "A";
        } else if (score >= 80) {
            return "B";
        } else if (score >= 70) {
            return "C";
        } else {
            return "F";
        }
    }
}
```

**解答**:
```java
@Test
public void testCalculateGrade_BranchCoverage() {
    ScoreCalculator calc = new ScoreCalculator();
    
    // 分岐1-True: 無効スコア
    assertEquals("Invalid score", calc.calculateGrade(-1, false));
    
    // 分岐1-False, 分岐2-True, 分岐3-True: ボーナスあり+A
    assertEquals("A", calc.calculateGrade(87, true));  // 87+5=92
    
    // 分岐2-False, 分岐3-False, 分岐4-True: ボーナスなし+B
    assertEquals("B", calc.calculateGrade(85, false));
    
    // 分岐4-False, 分岐5-True: C
    assertEquals("C", calc.calculateGrade(75, false));
    
    // 分岐5-False: F
    assertEquals("F", calc.calculateGrade(65, false));
}
```

**採点基準**:
- すべての分岐を特定（10点）
- 適切なテストケース設計（10点）

---

### 💪 問題5（20点）
以下のコードの問題点を分岐網羅の観点から指摘し、改善案を提示してください。

```java
public class LoginService {
    public boolean authenticate(String username, String password) {
        if (username != null && password != null) {
            if (username.length() > 0 && password.length() >= 8) {
                return validateCredentials(username, password);
            }
        }
        return false;
    }
    
    private boolean validateCredentials(String user, String pass) {
        // 実際の認証ロジック（仮想）
        return "admin".equals(user) && "password123".equals(pass);
    }
}
```

**現在のテストケース**:
```java
@Test
public void testAuthenticate() {
    LoginService service = new LoginService();
    assertTrue(service.authenticate("admin", "password123"));
}
```

**解答**:

**問題点**:
1. 分岐網羅率が低い（約25%）
2. 例外系の分岐がテストされていない
3. 境界条件がテストされていない

**改善されたテストケース**:
```java
@Test
public void testAuthenticate_BranchCoverage() {
    LoginService service = new LoginService();
    
    // 正常系（分岐全True）
    assertTrue(service.authenticate("admin", "password123"));
    
    // null username（分岐1-False）
    assertFalse(service.authenticate(null, "password123"));
    
    // null password（分岐1-False）
    assertFalse(service.authenticate("admin", null));
    
    // 空username（分岐2-False）
    assertFalse(service.authenticate("", "password123"));
    
    // 短いpassword（分岐2-False）
    assertFalse(service.authenticate("admin", "short"));
    
    // 無効な認証情報（分岐3-False）
    assertFalse(service.authenticate("user", "wrongpass"));
}
```

**採点基準**:
- 問題点の適切な指摘（10点）
- 改善案の提示（10点）

---

### 💪 問題6（20点）
実務シナリオでの分岐網羅適用を考えてください。

**シナリオ**: 
あなたは金融システムの開発チームに所属しており、以下の送金処理メソッドの品質を確保する必要があります。このメソッドで100%分岐網羅を達成するテスト戦略を立ててください。

```java
public class TransferService {
    public TransferResult transfer(Account from, Account to, BigDecimal amount) {
        // 入力検証
        if (from == null || to == null || amount == null) {
            return new TransferResult(false, "Invalid input");
        }
        
        if (amount.compareTo(BigDecimal.ZERO) <= 0) {
            return new TransferResult(false, "Amount must be positive");
        }
        
        // 残高チェック
        if (from.getBalance().compareTo(amount) < 0) {
            return new TransferResult(false, "Insufficient funds");
        }
        
        // 送金限度額チェック
        if (amount.compareTo(new BigDecimal("10000")) > 0) {
            if (!from.isVipAccount()) {
                return new TransferResult(false, "Amount exceeds limit");
            }
        }
        
        // 送金実行
        try {
            from.withdraw(amount);
            to.deposit(amount);
            return new TransferResult(true, "Transfer successful");
        } catch (Exception e) {
            return new TransferResult(false, "Transfer failed: " + e.getMessage());
        }
    }
}
```

**解答例**:

**分岐分析**:
1. `from == null || to == null || amount == null`: T/F
2. `amount.compareTo(BigDecimal.ZERO) <= 0`: T/F
3. `from.getBalance().compareTo(amount) < 0`: T/F
4. `amount.compareTo(new BigDecimal("10000")) > 0`: T/F
5. `!from.isVipAccount()`: T/F（高額送金時）
6. `try-catch`: 正常/例外

**テスト戦略**:
```java
@Test
public void testTransfer_BranchCoverage() {
    // 1. null入力テスト
    assertEquals("Invalid input", 
        service.transfer(null, toAccount, amount).getMessage());
    
    // 2. 負の金額テスト
    assertEquals("Amount must be positive", 
        service.transfer(fromAccount, toAccount, new BigDecimal("-100")).getMessage());
    
    // 3. 残高不足テスト
    fromAccount.setBalance(new BigDecimal("50"));
    assertEquals("Insufficient funds", 
        service.transfer(fromAccount, toAccount, new BigDecimal("100")).getMessage());
    
    // 4. 高額送金（非VIP）テスト
    fromAccount.setBalance(new BigDecimal("20000"));
    fromAccount.setVipAccount(false);
    assertEquals("Amount exceeds limit", 
        service.transfer(fromAccount, toAccount, new BigDecimal("15000")).getMessage());
    
    // 5. 高額送金（VIP）テスト
    fromAccount.setVipAccount(true);
    assertEquals("Transfer successful", 
        service.transfer(fromAccount, toAccount, new BigDecimal("15000")).getMessage());
    
    // 6. 正常送金テスト
    assertEquals("Transfer successful", 
        service.transfer(fromAccount, toAccount, new BigDecimal("100")).getMessage());
    
    // 7. 例外発生テスト（モックで例外発生）
    // when(fromAccount.withdraw(any())).thenThrow(new RuntimeException("DB Error"));
}
```

**採点基準**:
- 分岐の適切な特定（10点）
- 実務を考慮したテスト戦略（10点）

---

## 📊 評価基準と次のステップ

### 🎯 得点評価
- **90-100点**: 優秀 → 上級演習に進む
- **75-89点**: 良好 → 上級演習に進む
- **60-74点**: 合格 → 基本演習を再確認後、上級演習へ
- **60点未満**: 要復習 → 理論学習からやり直し

### 📚 レベル別次のアクション

#### 🌟 優秀レベル（90点以上）
**推奨アクション**:
- 直ちに「04_上級演習・実務レベル.md」に進む
- 条件網羅やMC/DC等の高度な技法も並行学習可能
- チームメンバーへの指導役も可能

#### 🌱 良好レベル（75-89点）
**推奨アクション**:
- 「04_上級演習・実務レベル.md」に進む
- 不明な点は適宜基本に戻って確認
- 実務での段階的適用を検討

#### 📖 合格レベル（60-74点）
**推奨アクション**:
- 間違えた問題の解説を再読
- 「02_理論学習・基本演習.md」の演習を再実行
- 理解度向上後に上級演習へ進む

#### ⚠️ 要復習レベル（60点未満）
**推奨アクション**:
- 「01_学習準備・概要把握.md」から再開
- 命令網羅の理解が不十分な可能性も確認
- 基礎知識の補強を最優先

### 🔍 理解度チェックポイント

**確認必須項目**:
- [ ] 分岐網羅の定義を正確に説明できる
- [ ] 命令網羅との違いを具体例で示せる
- [ ] 分岐網羅率を正しく計算できる
- [ ] 複雑なコードでも分岐を特定できる
- [ ] 効率的なテストケースを設計できる

**実務適用確認**:
- [ ] プロジェクトでの分岐網羅適用方法を理解している
- [ ] 分岐網羅の限界と課題を認識している
- [ ] 他のテスト技法との組み合わせ方法を理解している

---

## 💡 よくある間違いと対策

### ❌ よくある間違い1：分岐数の数え忘れ
**問題**: ループの条件評価を分岐として認識しない
**対策**: while、for文も条件評価で分岐が発生することを再確認

### ❌ よくある間違い2：短絡評価の見落とし
**問題**: `&&` や `||` の短絡評価を単一分岐として扱う
**対策**: 複合条件では各条件の評価が分岐となることを理解

### ❌ よくある間違い3：テストケースの冗長性
**問題**: 必要以上に多くのテストケースを作成
**対策**: 最小限のテストケースで最大の分岐網羅を達成する効率性を重視

---

## 🚀 次のステップ

習得レベル確認が完了したら、あなたのレベルに応じて次の学習に進んでください：

- **75点以上**: 「04_上級演習・実務レベル.md」で実践力を強化
- **60-74点**: 基本の再確認後、上級演習へ
- **60点未満**: 理論学習からの再開を推奨

分岐網羅をしっかりマスターして、より高度なテスト技法への土台を固めましょう！
