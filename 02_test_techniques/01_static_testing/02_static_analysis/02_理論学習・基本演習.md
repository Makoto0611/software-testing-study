# 🎯 静的解析 理論学習・基本演習

## 📚 静的解析の基本概念

### 🔍 静的解析の分類と技法

#### 📋 1. 構文解析 (Syntactic Analysis)
**目的**: コードの構文的正確性確認
**検出項目**:
- 構文エラー・タイポ
- 未使用変数・インポート
- 到達不可能コード

**基本演習1**: ESLintでJavaScriptコード解析
```javascript
// 問題のあるコード例
function calculateTotal(items) {
    let total = 0;
    let unused_var = "test";  // 未使用変数
    
    for (let i = 0; i < items.length; i++) {
        total += items[i].price
    }
    
    return total;
    // この行以降は到達不可能
    console.log("完了");
}
```

**演習課題**: 上記コードの問題点を特定し、静的解析ツールでの検出方法を確認してください。

#### 🔍 2. セマンティック解析 (Semantic Analysis)
**目的**: コードの意味的正確性確認
**検出項目**:
- 型の不整合
- 未定義変数の参照
- スコープ違反

**基本演習2**: 型チェック実践
```python
# 型に関する問題のあるコード
def process_data(data: list) -> int:
    total = 0
    for item in data:
        total += item  # item の型が不明
    
    return str(total)  # 戻り値の型が不整合
```

#### 🔒 3. セキュリティ分析
**目的**: セキュリティ脆弱性の検出
**OWASP Top 10対応**:
- SQLインジェクション
- XSS (Cross-Site Scripting)
- 認証・認可の欠陥

**基本演習3**: セキュリティ脆弱性検出
```java
// SQLインジェクション脆弱性のあるコード
public class UserDAO {
    public User findUser(String username) {
        String sql = "SELECT * FROM users WHERE username = '" + username + "'";
        // 直接的な文字列結合 - SQLインジェクション脆弱性
        return database.query(sql);
    }
}
```

### 🛠️ 主要ツールの実践

## 📊 SonarQube実践

### 🎯 基本設定・操作
```bash
# SonarQubeの基本実行
sonar-scanner \
  -Dsonar.projectKey=my-project \
  -Dsonar.sources=src \
  -Dsonar.host.url=http://localhost:9000
```

### 📋 品質ゲート設定
```yaml
# sonar-project.properties
sonar.projectKey=test-project
sonar.projectName=Test Project
sonar.sources=src
sonar.exclusions=**/*test*/**,**/node_modules/**

# 品質基準
sonar.qualitygate.wait=true
sonar.coverage.minimum=80
sonar.duplicated_lines_density.maximum=3
```

## 🔧 言語別ツール実践

### 🟨 JavaScript/TypeScript
**ESLint設定例**:
```json
{
  "extends": ["eslint:recommended", "@typescript-eslint/recommended"],
  "rules": {
    "no-unused-vars": "error",
    "complexity": ["error", 10],
    "max-lines-per-function": ["error", 50]
  }
}
```

**演習**: TypeScriptプロジェクトでESLint設定・実行

### 🐍 Python
**Pylint + Black設定例**:
```ini
# .pylintrc
[MASTER]
load-plugins=pylint.extensions.docparams

[MESSAGES CONTROL]
disable=missing-docstring,line-too-long

[FORMAT]
max-line-length=88
```

### ☕ Java
**Checkstyle + SpotBugs設定例**:
```xml
<!-- checkstyle.xml -->
<module name="Checker">
    <module name="LineLength">
        <property name="max" value="120"/>
    </module>
    <module name="TreeWalker">
        <module name="CyclomaticComplexity">
            <property name="max" value="10"/>
        </module>
    </module>
</module>
```

### 📊 メトリクス解析実践

#### 🎯 複雑度測定演習
```python
# 複雑度の高いコード例（改善前）
def process_order(order, customer_type, discount_code, season):
    if customer_type == "premium":
        if discount_code == "SUMMER20":
            if season == "summer":
                return order.total * 0.6
            else:
                return order.total * 0.8
        elif discount_code == "WINTER15":
            if season == "winter":
                return order.total * 0.7
            else:
                return order.total * 0.85
        else:
            return order.total * 0.9
    elif customer_type == "regular":
        if discount_code == "SUMMER20":
            return order.total * 0.8
        else:
            return order.total * 0.95
    else:
        return order.total

# 複雑度を下げた改善版
def process_order_improved(order, customer_type, discount_code, season):
    discount_rules = {
        ("premium", "SUMMER20", "summer"): 0.6,
        ("premium", "SUMMER20", "other"): 0.8,
        ("premium", "WINTER15", "winter"): 0.7,
        ("premium", "WINTER15", "other"): 0.85,
        ("premium", "other", "any"): 0.9,
        ("regular", "SUMMER20", "any"): 0.8,
        ("regular", "other", "any"): 0.95
    }
    
    return order.total * get_discount_rate(discount_rules, customer_type, discount_code, season)
```

**演習課題**: 上記コードの複雑度を測定し、改善効果を確認してください。

### 🔄 CI/CD統合実践

#### 📋 GitHub Actions設定例
```yaml
name: Code Quality Check

on: [push, pull_request]

jobs:
  quality:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v2
    
    - name: Setup Node.js
      uses: actions/setup-node@v2
      with:
        node-version: '16'
    
    - name: Install dependencies
      run: npm install
    
    - name: Run ESLint
      run: npm run lint
    
    - name: Run SonarQube Scan
      uses: sonarqube-quality-gate-action@master
      env:
        SONAR_TOKEN: ${{ secrets.SONAR_TOKEN }}
    
    - name: Quality Gate Check
      run: |
        if [[ "${{ env.QUALITY_GATE_STATUS }}" != "PASSED" ]]; then
          echo "Quality gate failed"
          exit 1
        fi
```

### 📊 実践課題

#### 🎯 総合演習: プロジェクト品質改善
**シナリオ**: 既存のWebアプリケーションの品質改善

**与えられた情報**:
- 言語: TypeScript (React)
- 現状の課題: 保守性が低い、バグが多い
- 目標: 品質指標を業界標準レベルに改善

**演習ステップ**:
1. 静的解析ツールの選定・設定
2. ベースライン品質測定
3. 品質改善目標の設定
4. 段階的な改善実施
5. 効果測定・報告

**成果物**:
- 品質改善計画書
- ツール設定ファイル
- 改善前後の比較レポート

---
**次のステップ**: 「03_習得レベル確認.md」で理解度とスキルを評価し、適切な学習ルートを決定しましょう。